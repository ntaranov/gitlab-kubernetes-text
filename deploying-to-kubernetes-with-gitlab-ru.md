# –†–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏–µ –≤ Kubernetes –∏–∑ GitLab

![–†–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏–µ –≤ Kubernetes –∏–∑ GitLab](img/cover.png)

–≠—Ç–æ –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ [–ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ —Ç—É—Ç–æ—Ä–∏–∞–ª–∞ –ø—Ä–æ –∫–æ–º–∞–Ω–¥–Ω—É—é —Ä–∞–∑—Ä–∞–±–æ—Ç–∫—É —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º GitLab](https://habr.com/ru/post/549862/). –§–æ–∫—É—Å –ø—Ä–µ–¥—ã–¥—É—â–µ–π —Å—Ç–∞—Ç—å–∏ –±—ã–ª –Ω–∞ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ –Ω–µ–ø—Ä–µ—Ä—ã–≤–Ω–æ–π –ø–æ—Å—Ç–∞–≤–∫–∏ –≤ —Ä–∞–±–æ—Ç–µ –∫–æ–º–∞–Ω–¥—ã. –í —ç—Ç–æ–π —Å—Ç–∞—Ç—å–µ –º—ã —É–¥–µ–ª–∏–º –æ—Å–Ω–æ–≤–Ω–æ–µ –≤–Ω–∏–º–∞–Ω–∏–µ –∏–º–µ–Ω–Ω–æ –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–º –¥–µ–π—Å—Ç–≤–∏—è–º –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–º –¥–ª—è —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏—è –∏–∑ GitLab –≤ Kubernetes.

–ê –∏–º–µ–Ω–Ω–æ –º—ã –≤–æ–∑—å–º—ë–º –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –ø—Ä–æ—Å—Ç–æ–µ –Ω–æ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å–æ–¥–µ—Ä–∂–∞—Ç–µ–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–∞ React.js, –¥–æ–∫–µ—Ä–∏–∑—É–µ–º –µ–≥–æ, –∑–∞—Ç–µ–º —Ä–∞–∑–≤–µ—Ä–Ω—ë–º –≤ Kubernetes –ª–æ–∫–∞–ª—å–Ω–æ –ø—Ä–∏ –ø–æ–º–æ—â–∏ Docker Desktop. –ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ —Ä–∞–∑–≤–µ—Ä–Ω—ë–º –µ–≥–æ —É–∂–µ –Ω–∞ Google Cloud Platform (GCP), –∏ –∑–∞–≤–µ—Ä—à–∏–º —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–æ–π CI/CD –∫–æ–Ω–≤–µ–π–µ—Ä–∞ –≤ GitLab –¥–ª—è –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –Ω–∞—à–µ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ Google Kubernetes Engine.

–ñ–µ–ª–∞—Ç–µ–ª—å–Ω—ã –Ω–æ –Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã –±–∞–∑–æ–≤—ã–µ –∑–Ω–∞–Ω–∏—è
- Docker;
- Kubernetes;
- Git;
- Node.js;
- React;
- Bash.

–í –¥–∞–ª—å–Ω–µ–π—à–µ–º –º—ã —Å–¥–µ–ª–∞–µ–º —Å–ª–µ–¥—É—é—â–µ–µ.
- üß± –ü–æ–∑–Ω–∞–∫–æ–º–∏–º—Å—è c –Ω–∞—à–∏–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º, –æ–±—Å—É–¥–∏–º –∏–∑ —á–µ–≥–æ –æ–Ω–æ —Å–æ—Å—Ç–æ–∏—Ç.
- üê≥ –î–æ–∫–µ—Ä–∏–∑—É–µ–º –Ω–∞—à–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ.
- ‚ò∏Ô∏è –†–∞–∑–≤–µ—Ä–Ω—ë–º –Ω–∞—à–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤ Kubernetes –ª–æ–∫–∞–ª—å–Ω–æ –Ω–∞ Docker Desktop.
- ‚òÅÔ∏è –û–±—Å—É–¥–∏–º –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ GCP –∏ –∫–∞–∫ –Ω—É–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å –Ω–∞—à–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ, –∞ –∑–∞—Ç–µ–º –µ—â—ë —Ä–∞–∑ —Ä–∞–∑–≤–µ—Ä–Ω—ë–º –Ω–∞—à–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤ Kubernetes –Ω–æ —É–∂–µ –≤ GCP.
- ü¶ä –ó–∞–≤–µ—Ä—à–∏–º –Ω–∞—à —Ç—É—Ç–æ—Ä–∏–∞–ª —Å–æ–∑–¥–∞–Ω–∏–µ–º –∫–æ–Ω–≤–µ–π–µ—Ä–∞ –¥–ª—è —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ GCP –ø—Ä–∏ –ø–æ–º–æ—â–∏ GitLab.

![–†–∞–∑–Ω—ã–µ —ç—Ç–∞–ø—ã –æ—Ç –¥–æ–∫–µ—Ä–∏–∑–∞—Ü–∏–∏ –¥–æ Kubernetes –Ω–∞ Google Cloud Platform](img/gitlab-kubernetes.gif)

–í—Ä–µ–º—è –æ—Ç –≤—Ä–µ–º–µ–Ω–∏ —è –±—É–¥—É –ø—Ä–æ—Å–∏—Ç—å –≤–∞—Å —á—Ç–æ-—Ç–æ —Å–¥–µ–ª–∞—Ç—å. –¢–∞–∫–∏–µ –º–æ–º–µ–Ω—Ç—ã –ø–æ–º–µ—á–µ–Ω—ã –∑–Ω–∞—á–∫–æ–º üõ†Ô∏è. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞ –≤—ã–ø–æ–ª–Ω—è–π—Ç–µ –¥–µ–π—Å—Ç–≤–∏—è –ø–æ –º–µ—Ä–µ —á—Ç–µ–Ω–∏—è —Ç–µ–∫—Å—Ç–∞ —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –æ—Ç –¥–∞–Ω–Ω–æ–≥–æ —Ç—É—Ç–æ—Ä–∏–∞–ª–∞ –Ω–∞–∏–±–æ–ª—å—à—É—é –ø–æ–ª—å–∑—É.

‚öôÔ∏è –î–ª—è —Ç–æ–≥–æ —á—Ç–æ–±—ã –ø—Ä–æ–π—Ç–∏ —ç—Ç–æ—Ç —Ç—É—Ç–æ—Ä–∏–∞–ª –Ω—É–∂–Ω–æ —á—Ç–æ–±—ã —ç—Ç–∏ –ø—Ä–æ–≥—Ä–∞–º–º—ã –±—ã–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –Ω–∞ –≤–∞—à–µ–º –∫–æ–º–ø—å—é—Ç–µ—Ä–µ.
- Bash Shell
- Git
- Node.js
- Docker Desktop
- –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –≤–µ–±-–±—Ä–∞—É–∑–µ—Ä

–ö–æ–º–∞–Ω–¥—ã –≤ —Ç–µ–∫—Å—Ç–µ —Ä–∞—Å—Å—á–∏—Ç–∞–Ω—ã –≤ `bash`, –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –∏–∑ –Ω–∏—Ö –∏—Å–ø–æ–ª—å–∑—É—é—Ç –∫–ª–∏–µ–Ω—Ç `git` –¥–ª—è –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏. –ï—Å–ª–∏ –≤—ã –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ Windows, —Ç–æ —Å–∞–º—ã–π –ø—Ä–æ—Å—Ç–æ–π —Å–ø–æ—Å–æ–± –ø–æ–ª—É—á–∏—Ç—å –∏ —Ç–æ –∏ –¥—Ä—É–≥–æ–µ - —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å [Git for Windows](https://git-scm.com/downloads).

–î–∞–ª–µ–µ –±—É–¥–µ–º –ø–æ–ª–∞–≥–∞—Ç—å —á—Ç–æ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ —Å –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–º–∏ —Ñ–∞–π–ª–∞–º–∏ `node`, `git`, `docker` –∏ `kubectl` –≤–∫–ª—é—á–µ–Ω—ã –≤ `PATH`.

## üß± –ó–Ω–∞–∫–æ–º—Å—Ç–≤–æ —Å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º

üì¢ –ó–Ω–∞–∫–æ–º—Å—Ç–≤–æ —Å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º –±—É–¥–µ—Ç –≤–∫–ª—é—á–∞—Ç—å —ç—Ç–∏ —à–∞–≥–∏.
- –ö–ª–æ–Ω–∏—Ä—É–µ–º —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –∏ –≤—ã—è—Å–Ω–∏–º –∏–∑ —á–µ–≥–æ —Å–æ—Å—Ç–æ–∏—Ç –Ω–∞—à–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ.
- –ó–∞–ø—É—Å—Ç–∏–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤ –∫–æ–Ω—Å–æ–ª–∏.
- –£–≤–∏–¥–∏–º –∫–∞–∫–∏–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –±—É–¥–µ—Ç –≤ –¥–∞–ª—å–Ω–µ–π—à–µ–º –≤ —Ä–∞–∑–≤—ë—Ä–Ω—É—Ç–æ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏.

### –ò–∑ —á–µ–≥–æ —Å–æ—Å—Ç–æ–∏—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

üõ†Ô∏è –ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –∏ –ø–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
```bash
git clone https://github.com/ntaranov/gitlab-kubernetes
cd gitlab-kubernetes
```

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ –¥–≤—É—Ö —á–∞—Å—Ç–µ–π
- Single Page Application (**SPA**) - —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π —Å–∞–π—Ç –Ω–∞ React –∫–æ—Ç–æ—Ä—ã–π –ø–æ–ª—É—á–∞–µ—Ç –∏ –∏–∑–º–µ–Ω—è–µ—Ç –¥–∞–Ω–Ω—ã–µ, –æ—Ç–ø—Ä–∞–≤–ª—è—è AJAX-–∑–∞–ø—Ä–æ—Å—ã –∫ —Å–µ—Ä–≤–∏—Å—É **API**.
- **API** - –≤–µ–± —Å–µ—Ä–≤–∏—Å, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –æ "–∑–∞–ø–∏—Å–∞–≤—à–∏—Ö—Å—è" –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è—Ö –∏ –º–æ–∂–µ—Ç –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ. API –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ, –∫–æ—Ç–æ—Ä—ã–µ –¥–æ–ª–∂–Ω—ã –Ω–∞–¥—ë–∂–Ω–æ —Ö—Ä–∞–Ω–∏—Ç—å—Å—è, –≤ —Ñ–∞–π–ª. –ú—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ñ–∞–π–ª —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –ª–∏—à–Ω–∏—Ö –¥–ª—è —Ç—É—Ç–æ—Ä–∏–∞–ª–∞ —Å–ª–æ–∂–Ω–æ—Å—Ç–µ–π, –∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–∏–≤–Ω–µ—Å–ª–∞ –±—ã —Ä–∞–±–æ—Ç–∞ —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ, —Ñ–∞–π–ª –ø–æ–∑–≤–æ–ª—è–µ—Ç –Ω–∞–º –ø–æ–≥–æ–≤–æ—Ä–∏—Ç—å –æ persistent volumes.

–ó–∞—á–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏–º–µ–Ω–Ω–æ —Ç–∞–∫–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è —ç—Ç–æ–≥–æ —Ç—É—Ç–æ—Ä–∏–∞–ª–∞? –ù—É, —ç—Ç–æ —Å–∞–º–æ–µ –ø—Ä–æ—Å—Ç–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ —É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä—è–µ—Ç —Ç–∞–∫–∏–º —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º. 
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –≤–µ–±-—Ñ—Ä–µ–π–º–≤–æ—Ä–∫ (React.js), —Ç—Ä–µ–±—É—é—â–∏–π –∫–æ–º–ø–∏–ª—è—Ü–∏–∏ –∫–æ–¥–∞.
- –¢—Ä–µ–±—É–µ—Ç –ø–µ—Ä–µ–¥–∞—á–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ (`API_URL`) –Ω–∞ —ç—Ç–∞–ø–µ —Å–±–æ—Ä–∫–∏.
- –°–æ–¥–µ—Ä–∂–∏—Ç —Å–µ—Ä–≤–µ—Ä–Ω—ã–π –∫–æ–¥.
- –í–∫–ª—é—á–∞–µ—Ç Front End –∏ API –¥–ª—è —ç–º—É–ª—è—Ü–∏–∏ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã.
- –ò–º–µ–µ—Ç –Ω–µ–∫–æ—Ç–æ—Ä–æ–µ —Ö—Ä–∞–Ω–∏–º–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ (persistent state).
- –°–æ–¥–µ—Ä–∂–∏—Ç —Ç–µ—Å—Ç—ã.

–Ø —Å—Ç—Ä–µ–º–∏–ª—Å—è —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–∞–∏–±–æ–ª–µ–µ –ø—Ä–æ—Å—Ç—ã–º, –ø–æ—ç—Ç–æ–º—É —è —Å–æ–∑–Ω–∞—Ç–µ–ª—å–Ω–æ –Ω–µ –≤–∫–ª—é—á–∏–ª —Ç–∞–∫–∏–µ –≤–µ—â–∏:
- –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é;
- –ª–æ–≥–∏ –∏ —Ç–µ–ª–µ–º–µ—Ç—Ä–∏—é;
- –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫;
- –≤–∑–∞–∏–º–æ–¥–µ–π—Ç—Å–≤–∏–µ —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö;
- –∫–∞–∫–æ–≥–æ –ª–∏–±–æ –æ—Å–º—ã—Å–ª–µ–Ω–Ω–æ–≥–æ –ø–æ–∫—Ä—ã—Ç–∏—è —Ç–µ—Å—Ç–∞–º–∏.

–¶–µ–ª—å —Ç—É—Ç–æ—Ä–∏–∞–ª–∞ –≤ —Ç–æ–º —á—Ç–æ–±—ã –ø—Ä–∏–≤–µ—Å—Ç–∏ –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –ø—Ä–∏–º–µ—Ä –¥–ª—è —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏—è –Ω–∞ Kubernetes –∏ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è –∫–æ–Ω–≤–µ–π–µ—Ä–∞ –≤ GitLab. –î–∞–∂–µ –Ω–µ—Å–º–æ—Ç—Ä—è –Ω–∞ –≤—Å–µ —É–ø—Ä–æ—â–µ–Ω–∏—è —Ç—É—Ç–æ—Ä–∏–∞–ª –ø–æ–ª—É—á–∏–ª—Å—è –¥–æ–≤–æ–ª—å–Ω–æ –æ–≥—Ä–æ–º–Ω—ã–π.

–í–Ω—É—Ç—Ä–∏ —Ç–æ–ª—å–∫–æ —á—Ç–æ –∫–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è –±—É–¥—É—Ç —Ñ–∞–π–ª—ã –∏ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏:
```javascript
api                 // –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è —Å —Ñ–∞–π–ª–∞–º–∏ API
  /data/log         // –ë—É–¥–µ–º —Å—é–¥–∞ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –¥–∞–Ω–Ω—ã–µ
  /package.json     // NPM –ú–∞–Ω–∏—Ñ–µ—Å—Ç API
  /server.js        // –ö–æ–¥ API, –Ω–µ —Ç—Ä–µ–±—É–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –¥—Ä—É–≥–∏—Ö –ø–∞–∫–µ—Ç–æ–≤
spa                 // –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è —Å —Ñ–∞–π–ª–∞–º–∏ SPA
  /public/.         // –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã React
  /src
    /components
      /Log.jsx      // –≠—Ç–æ—Ç –∫–æ–º–ø–æ–Ω–µ–Ω—Ç —à–ª—ë—Ç –∑–∞–ø—Ä–æ—Å—ã –∫ API
    /App.js         // –ì–ª–∞–≤–Ω—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è SPA
    /App.test.js    // –¢–µ—Å—Ç—ã, —É –Ω–∞—Å –∂–µ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Ç–µ—Å—Ç—ã
    /config.js      // –ó–∞–≥—Ä—É–∂–∞–µ—Ç URL API –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –æ–∫—Ä—É–∂–µ–Ω–∏—è
    /index.js       // –ö–æ—Ä–µ–Ω—å React-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
  /package.json     // NPM –ú–∞–Ω–∏—Ñ–µ—Å—Ç SPA
  /package-lock.json  // –° —ç—Ç–∏–º–∏ –≤–µ—Ä—Å–∏—è–º–∏ –ø–∞–∫–µ—Ç–æ–≤ —Ä–∞–±–æ—Ç–∞–ª–æ
```

–û—Å—Ç–∞–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã –ª–∏–±–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã –¥–ª—è `create-react-app`, –ª–∏–±–æ –≤—Ç–æ—Ä–æ—Å—Ç–µ–ø–µ–Ω–Ω—ã –¥–ª—è –Ω–∞—à–µ–π –∑–∞–¥–∞—á–∏.

–û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ, —á—Ç–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –≤ —Ñ–∞–π–ª–µ `./spa/src/components/Log.jsx` –ø–æ—Å—Ä–µ–¥—Å—Ç–≤–æ–º –∫–æ–¥–∞ –∏–∑ `./spa/src/config.js` –ø–æ–ª—É—á–∞–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –æ–∫—Ä—É–∂–µ–Ω–∏—è `REACT_APP_API_URL`. –ï—Å–ª–∏ –Ω–∏—á–µ–≥–æ –Ω–µ –ø–µ—Ä–µ–¥–∞—Ç—å, –∫–æ–¥ –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –≥–æ–¥–Ω–æ–µ –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –Ω–∞ –ª–æ–∫–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω–µ, –Ω–æ –µ—Å–ª–∏ –º—ã –∑–∞—Ö–æ—Ç–∏–º —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—å –∫–æ–¥ –≥–¥–µ-–ª–∏–±–æ –µ—â—ë, –Ω–∞–º –ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è –ø—Ä–∏—Å–≤–æ–∏—Ç—å –∞–∫—Ç—É–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –¥–∞–Ω–Ω–æ–π –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –æ–∫—Ä—É–∂–µ–Ω–∏—è –Ω–∞ —ç—Ç–∞–ø–µ —Å–±–æ—Ä–∫–∏, –ø–µ—Ä–µ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ–º `npm run build`.

### –ó–∞–ø—É—Å–∫–∞–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ª–æ–∫–∞–ª—å–Ω–æ

![–ó–∞–ø—É—Å–∫–∞–µ–º –ª–æ–∫–∞–ª—å–Ω–æ –ø—Ä–∏ –ø–æ–º–æ—â–∏ Node.js](img/local_node_800.png)

–ó–∞–ø—É—Å—Ç–∏—Ç–µ **API** –∏ **SPA**. –ü—Ä–æ—â–µ –≤—Å–µ–≥–æ —ç—Ç–æ —Å–¥–µ–ª–∞—Ç—å –æ—Ç–∫—Ä—ã–≤ –¥–≤–∞ –∫–æ–Ω—Å–æ–ª—å–Ω—ã—Ö –æ–∫–Ω–∞.

üõ†Ô∏è –í –ø–µ—Ä–≤–æ–º –æ–∫–Ω–µ –∑–∞–ø—É—Å—Ç–∏—Ç–µ **API**.
```bash
cd api
node server.js
```

üõ†Ô∏è –í–æ –≤—Ç–æ—Ä–æ–º –æ–∫–Ω–µ –∑–∞–ø—É—Å—Ç–∏–º **SPA**.
```bash
cd spa
```

1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø–∞–∫–µ—Ç—ã **npm**, —É–∫–∞–∑–∞–Ω–Ω—ã–µ –≤ `package-lock.json`.
    ```
    npm ci
    ```
2. **SPA** –±—ã–ª–∞ —Å–æ–∑–¥–∞–Ω–∞ –ø—Ä–∏ –ø–æ–º–æ—â–∏ `create-react-app`. –ü–æ—ç—Ç–æ–º—É –∑–∞–ø—É—Å—Ç–∏–º –µ–≥–æ –ø—Ä–∏ –ø–æ–º–æ—â–∏ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–µ—Å–∫–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞ –∏–∑ `react-scripts`.
    ```
    npm run start
    ```

üõ†Ô∏è –û—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ **SPA** –ø–æ –∞–¥—Ä–µ—Å—É 
```
http://localhost:3000/
```

üõ†Ô∏è –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É **Log Me!**. –ë—É–¥–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω AJAX-–∑–∞–ø—Ä–æ—Å –ø–æ –∞–¥—Ä–µ—Å—É `http://localhost:3000/log` –∏ –¥–∞–Ω–Ω—ã–µ User Agent —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è 
–±—É–¥—É—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ —Ñ–∞–π–ª `./data/log`. –ù–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç –æ—Ç–æ–±—Ä–∞–∂–µ–Ω—ã –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –ø–æ–¥ –∫–Ω–æ–ø–∫–æ–π.

–ü–æ—á–µ–º—É **API**, –∑–∞–ø—É—â–µ–Ω–Ω—ã–π –Ω–∞ –ø–æ—Ä—Ç—É `4000` –ø–æ–ª—É—á–∞–µ—Ç –∑–∞–ø—Ä–æ—Å, –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π –ø–æ –∞–¥—Ä–µ—Å—É `http://localhost:3000/log`? –î–µ–ª–æ –≤ —Ç–æ–º —á—Ç–æ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–µ—Å–∫–∏–π —Å–µ—Ä–≤–µ—Ä  `create-react-app` —É–º–µ–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –∫–∞–∫ –ø—Ä–æ–∫—Å–∏, –∏ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–ø—Ä–æ—Å—ã –ø–æ –∞–¥—Ä–µ—Å—É `http://localhost:4000/log`. –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ `./spa/package.json`, –æ–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ –Ω–∞ –ø–æ—Å–ª–µ–¥–Ω—é—é —Å—Ç—Ä–æ—á–∫—É `"proxy": "http://localhost:4000"`.

–ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã –¥–ª—è **SPA** –≤—ã –º–æ–∂–µ—Ç–µ –∫–æ–º–∞–Ω–¥–æ–π
```
npm run test
```

–ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π —Å–∞–π—Ç –¥–ª—è —Ä–∞–∑–º–µ—â–µ–Ω–∏—è –Ω–∞ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–µ –º–æ–∂–Ω–æ –∫–æ–º–∞–Ω–¥–æ–π
```
npm run build
``` 

### –ß—Ç–æ –º—ã —Ö–æ—Ç–∏–º –≤–∏–¥–µ—Ç—å –≤ –∫–æ–Ω—Ü–µ?

–¶–µ–ª–µ–≤—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É –º–æ–∂–Ω–æ –æ—Ç–æ–±—Ä–∞–∑–∏—Ç—å –Ω–∞ —ç—Ç–æ–π –∫–∞—Ä—Ç–∏–Ω–∫–µ.

![–†–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏–µ –≤ Kubernetes –∏–∑ GitLab](/img/gitlab_gke_800.png)

–î–ª—è –ø—Ä–æ—Å—Ç–æ—Ç—ã –º—ã —Ö—Ä–∞–Ω–∏–º –¥–∞–Ω–Ω—ã–µ –≤ —Ñ–∞–π–ª–µ, –Ω–æ –µ—Å–ª–∏ –ø–µ—Ä–µ–π—Ç–∏ –Ω–∞ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –≤ –ë–î, –Ω–∞—à–∞ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å—Ç–∞–Ω–µ—Ç –≤—ã—Å–æ–∫–æ–¥–æ—Å—Ç—É–ø–Ω–æ–π.

–í –ø–µ—Ä–≤—É—é –æ—á–µ—Ä–µ–¥—å –Ω–∞–º –Ω—É–∂–Ω–æ —É–ø–∞–∫–æ–≤–∞—Ç—å –Ω–∞—à–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤ –∫–∞—á–µ—Å—Ç–≤–µ –æ–±—Ä–∞–∑–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ Docker.

## üê≥ –î–æ–∫–µ—Ä–∏–∑—É–µ–º –Ω–∞—à–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

![–î–æ–∫–µ—Ä–∏–∑—É–µ–º –Ω–∞—à–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ](img/local_docker_800.png)

–•–æ—Ä–æ—à–µ–µ –≤–≤–µ–¥–µ–Ω–∏–µ –≤ –æ—Å–Ω–æ–≤—ã Docker [–µ—Å—Ç—å –Ω–∞ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–º —Å–∞–π—Ç–µ](https://docs.docker.com/get-started/).

üì¢ –î–ª—è —Ç–æ–≥–æ —á—Ç–æ –±—ã –¥–æ–∫–µ—Ä–∏–∑–æ–≤–∞—Ç—å –Ω–∞—à–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –º—ã –≤–Ω–∞—á–∞–ª–µ –¥–æ–∫–µ—Ä–∏–∑—É–µ–º **API** –∞ –∑–∞—Ç–µ–º **SPA**.

### –î–æ–∫–µ—Ä–∏–∑—É–µ–º API

–î–ª—è —Ç–æ–≥–æ —á—Ç–æ–±—ã –æ—Å—É—â–µ—Å—Ç–≤–∏—Ç—å —Å–±–æ—Ä–∫—É –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ Docker, [—Ç—Ä–µ–±—É–µ—Ç—Å—è —Å–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª —Å –∏–º–µ–Ω–µ–º `Dockerfile`](https://docs.docker.com/get-started/02_our_app/). 

üõ†Ô∏è –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é `./api` –∏ —Å–æ–∑–¥–∞–π—Ç–µ –≤–Ω—É—Ç—Ä–∏ —Ñ–∞–π–ª `Dockerfile` —Å —Ç–∞–∫–∏–º –∫–æ–¥–æ–º.
```dockerfile
# –∏—Å–ø–æ–ª—å–∑—É–µ–º Alpine Linux —á—Ç–æ–±—ã –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –±—ã–ª –º–µ–Ω—å—à–µ
FROM node:16-alpine
WORKDIR /app
RUN mkdir data
# –∫–æ–ø–∏—Ä—É–µ–º –∫–æ–¥ —Å–µ—Ä–≤–∏—Å–∞
COPY server.js ./
CMD ["node", "server.js"]
```

üõ†Ô∏è –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ Docker Desktop –∑–∞–ø—É—â–µ–Ω. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –ª–æ–∫–∞–ª—å–Ω—É—é —Å–±–æ—Ä–∫—É –∏ –ø—Ä–∏—Å–≤–æ–π—Ç–µ –æ–±—Ä–∞–∑—É —Ç–µ–≥ `gitlab-course-api`
```bash
docker build . -t gitlab-course-api
```

üõ†Ô∏è –ó–∞–ø—É—Å—Ç–∏—Ç–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –Ω–∞ –æ—Å–Ω–æ–≤–µ –æ–±—Ä–∞–∑–∞
```bash
docker run --publish 4000:4000 -d gitlab-course-api
```
–≠—Ç–∞ –∫–æ–º–∞–Ω–¥–∞ –≤—ã–≤–µ–¥–µ—Ç —Ö—ç—à –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞, –∫–æ—Ç–æ—Ä—ã–π –≤—ã —Å–º–æ–∂–µ—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —á—Ç–æ–±—ã –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –≤ –¥–∞–ª—å–Ω–µ–π—à–µ–º.
–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ —Å–µ—Ä–≤–∏—Å –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–µ—Å—Ç–æ–≤—É—é —Å—Ç—Ä–æ–∫—É –ø—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ –∫ `http://localhost:4000/log`.

### –î–æ–∫–µ—Ä–∏–∑—É–µ–º SPA

üõ†Ô∏è –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ **API** –¥–æ–±–∞–≤–∏–º –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é `./spa` `Dockerfile`. 
```dockerfile
# —Å—Ä–µ–¥–∞ —Å–±–æ—Ä–∫–∏
FROM node:14-alpine as builder
WORKDIR /app
ENV PATH /app/node_modules/.bin:$PATH

# –∫–æ–ø–∏—Ä—É–µ–º –∏—Å—Ö–æ–¥–Ω–∏–∫–∏ React-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤ —Å—Ä–µ–¥—É —Å–±–æ—Ä–∫–∏
COPY package.json ./
COPY package-lock.json ./
COPY src ./src
COPY public ./public

# —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º NPM-–ø–∞–∫–µ—Ç—ã –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å package-lock.json
RUN npm ci

# –º—ã –¥–æ–ª–∂–Ω—ã –ø–µ—Ä–µ–¥–∞—Ç—å —ç—Ç–æ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä —á–µ—Ä–µ–∑ --build-arg –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ —Å–±–æ—Ä–∫–∏
ARG API_URL
# –æ—Å—É—â–µ—Å—Ç–≤–ª—è–µ–º —Å–±–æ—Ä–∫—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–∞ React —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä–∞
RUN REACT_APP_API_URL=$API_URL npm run build

# –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–∞—è —Å—Ä–µ–¥–∞
FROM nginx:stable-alpine
# –∫–æ–ø–∏—Ä—É–µ–º –ø–æ–ª—É—á–∏–≤—à–∏–π—Å—è –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ —Å–±–æ—Ä–∫–∏ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π —Å–∞–π—Ç –∏–∑ "—Ç—è–∂—ë–ª–æ–≥–æ" –æ–±—Ä–∞–∑–∞
# –Ω–∞ –º–∞–ª–µ–Ω—å–∫–∏–π –æ–±—Ä–∞–∑ —Å –≤–µ–±-—Å–µ—Ä–≤–µ—Ä–æ–º nginx
COPY --from=builder /app/build /usr/share/nginx/html
EXPOSE 80
CMD ["nginx", "-g", "daemon off;"]
```

–í –¥–∞–Ω–Ω–æ–º —Å–ª—É—á–∞–µ `Dockerfile` –≤—ã—à–µ–ª –ø–æ—Å–ª–æ–∂–Ω–µ–µ. –î–ª—è —Ç–æ–≥–æ —á—Ç–æ–±—ã –ø–æ–Ω—è—Ç—å –∑–∞—á–µ–º —Ç–∞–∫–∏–µ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏, –¥–∞–≤–∞–π—Ç–µ –ø–æ–π–º—ë–º –∫–∞–∫ –º—ã –º–æ–∂–µ–º —Å–æ–±–∏—Ä–∞—Ç—å **SPA**. –ú—ã –º–æ–≥–ª–∏ –±—ã –æ—Å—É—â–µ—Å—Ç–≤–ª—è—Ç—å —Å–±–æ—Ä–∫—É
- –ª–æ–∫–∞–ª—å–Ω–æ; 
- –Ω–∞ –æ—Ç–¥–µ–ª—å–Ω–æ–º —Å–µ—Ä–≤–µ—Ä–µ;
- –ø—Ä—è–º–æ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ.

–í —Å–ª—É—á–∞–µ –ª–æ–∫–∞–ª—å–Ω–æ–π —Å–±–æ—Ä–∫–∏ **SPA** —Å—Ä–µ–¥–∞ —Å–±–æ—Ä–∫–∏ –±—É–¥–µ—Ç —Ä–∞–∑–ª–∏—á–∞—Ç—å—Å—è –æ—Ç —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞ –∫ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫—É.  
–° –ø–æ—Å–ª–µ–¥–Ω–∏–º–∏ –¥–≤—É–º—è –≤–∞—Ä–∏–∞–Ω—Ç–∞–º–∏ –≤—Å—ë –≤ –ø–æ—Ä—è–¥–∫–µ, –¥–ª—è –ø—Ä–æ—Å—Ç–æ—Ç—ã –≤—ã–±–µ—Ä–µ–º –≤–∞—Ä–∏–∞–Ω—Ç —Å–±–æ—Ä–∫–∏ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ.  
–ú—ã —Ö–æ—Ç–µ–ª–∏ –±—ã —á—Ç–æ–±—ã –æ–±—Ä–∞–∑ –Ω–∞—à–µ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ–π —Å—Ä–µ–¥–µ –±—ã–ª –∫–∞–∫ –º–æ–∂–Ω–æ –º–µ–Ω—å—à–µ –∏ —Å–æ–¥–µ—Ä–∂–∞–ª –º–∏–Ω–∏–º—É–º —Å–æ—Ñ—Ç–∞ –∏–∑ —Å–æ–æ–±—Ä–∞–∂–µ–Ω–∏–π —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏ –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏. –¢–∞–∫ –∫–∞–∫ –Ω–∞—à–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–∞ React –≤—Å–µ–≥–æ –ª–∏—à—å —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π —Å–∞–π—Ç, –Ω–∞ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–µ –Ω–∞–º –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ª–∏—à—å –Ω–µ–±–æ–ª—å—à–æ–≥–æ –æ–±—Ä–∞–∑–∞ —Å –≤–µ–±-—Å–µ—Ä–≤–µ—Ä–æ–º. –û–¥–Ω–∞–∫–æ, —á—Ç–æ–±—ã "—Å–æ–±—Ä–∞—Ç—å" –Ω–∞—à–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è **Node.js**, –∞ —Ç–∞–∫–∂–µ –Ω—É–∂–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏, –∞ —ç—Ç–æ —Ü–µ–ª–∞—è –∫—É—á–∞ –ø–∞–∫–µ—Ç–æ–≤. –ß—Ç–æ–±—ã —Ä–∞–∑—Ä–µ—à–∏—Ç—å —ç—Ç–æ –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏–µ, –º—ã –∏ –∏—Å–ø–æ–ª—å–∑—É–µ–º –ø–∞—Ç—Ç–µ—Ä–Ω, –∫–æ—Ç–æ—Ä—ã–π –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è multi-stage build. –ú—ã –≤–Ω–∞—á–∞–ª–µ —Å–æ–±–∏—Ä–∞–µ–º –Ω–∞—à–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤ "—Ç—è–∂—ë–ª–æ–º" –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ –∫–æ—Ç–æ—Ä—ã–π –ø–æ —Å—É—Ç–∏ —è–≤–ª—è–µ—Ç—Å—è —Å—Ä–µ–¥–æ–π —Å–±–æ—Ä–∫–∏ –∞ –∑–∞—Ç–µ–º –∫–æ–ø–∏—Ä—É–µ–º –ª–∏—à—å –ø–æ–ª—É—á–∏–≤—à–∏–π—Å—è —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π —Å–∞–π—Ç –≤ –ª–µ–≥–∫–æ–≤–µ—Å–Ω—ã–π –æ–±—Ä–∞–∑, –∫–æ—Ç–æ—Ä—ã–π –∏ –±—É–¥–µ—Ç "—Ä–∞–∑–¥–∞–≤–∞—Ç—å" –µ–≥–æ –≤ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ–π —Å—Ä–µ–¥–µ.

üõ†Ô∏è –°–æ–±–µ—Ä–∏—Ç–µ –æ–±—Ä–∞–∑ **SPA**,  –∑–∞–ø—É—Å—Ç–∏–≤ —ç—Ç—É –∫–æ–º–∞–Ω–¥—É –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ —Å–æ –≤–Ω–æ–≤—å —Å–æ–∑–¥–∞–Ω–Ω—ã–º `Dockerfile`. –û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ —á—Ç–æ –º—ã –ø–µ—Ä–µ–¥–∞—ë–º –∞–¥—Ä–µ—Å **API** –≤ –∫–∞—á–µ—Å—Ç–≤–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ —á—Ç–æ–±—ã –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ —Å–±–æ—Ä–∫–∏ –æ–∫–∞–∑–∞–ª–∞—Å—å –æ–±—ä—è–≤–ª–µ–Ω–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è `REACT_APP_API_URL`.
```bash
docker build .  --build-arg API_URL=http://localhost:4000 -t  gitlab-course-spa
```
–£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ —Å–±–æ—Ä–∫–∞ –±—ã–ª–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ.

üõ†Ô∏è –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–ª–µ–¥—É—é—â—É—é –∫–æ–º–∞–Ω–¥—É —á—Ç–æ–±—ã –∑–∞–ø—É—Å—Ç–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ç–æ–ª—å–∫–æ —á—Ç–æ —Å–æ–∑–¥–∞–Ω–Ω–æ–≥–æ –æ–±—Ä–∞–∑–∞.
```bash
docker run -it --publish 80:80 gitlab-course-spa
```

–ï—Å–ª–∏ –ø–æ—Ä—Ç `80` –ø–æ –∫–∞–∫–æ–π-—Ç–æ –ø—Ä–∏—á–∏–Ω–µ –∑–∞–Ω—è—Ç –Ω–∞ –≤–∞—à–µ–º –∫–æ–º–ø—å—é—Ç–µ—Ä–µ, –≤—ã –º–æ–∂–µ—Ç–µ –æ–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å —ç—Ç–æ—Ç –ø–æ—Ä—Ç –Ω–∞ –¥—Ä—É–≥–æ–º –ø–æ—Ä—Ç—É —Ö–æ—Å—Ç–∞, –Ω–∞–ø—Ä–∏–º–µ—Ä —Ç–∞–∫ `-p 8080:80`.

üõ†Ô∏è –û—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É **SPA** `http://localhost`. –í—ã –¥–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å —Ç—É –∂–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É —á—Ç–æ –∏ –ø—Ä–∏ –ª–æ–∫–∞–ª—å–Ω–æ–º —Ç–µ—Å—Ç–µ, –æ–¥–Ω–∞–∫–æ –ø–æ–ø—ã—Ç–∫–∞ –≤—ã–∑–≤–∞—Ç—å **API** –¥–æ–ª–∂–Ω–∞ –∑–∞–≤–µ—Ä—à–∞—Ç—å—Å—è –Ω–µ—É—Å–ø–µ—à–Ω–æ —Å –æ—à–∏–±–∫–æ–π —Å–≤—è–∑–∞–Ω–Ω–æ–π —Å [CORS](https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS).

–≠—Ç–æ –ø–æ—Ç–æ–º—É —á—Ç–æ —Å —Ç–æ—á–∫–∏ –∑—Ä–µ–Ω–∏—è same origin policy/CORS –¥–æ–ª–∂–Ω—ã —Å–æ–≤–ø–∞–¥–∞—Ç—å –ø—Ä–æ—Ç–æ–∫–æ–ª, –¥–æ–º–µ–Ω–Ω–æ–µ –∏–º—è –∏ –ø–æ—Ä—Ç, –∞ –µ—Å–ª–∏ –æ–Ω–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç, —Ç–æ —ç—Ç–æ —Ä–∞–∑–Ω—ã–µ —Å–∞–π—Ç—ã. `http://localhost:80` –∏ `http://localhost:4000` - —Ä–∞–∑–Ω—ã–µ —Å–∞–π—Ç—ã. –û–±—ã—á–Ω–æ –¥–ª—è —Ç–æ–≥–æ, —á—Ç–æ–±—ã —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Å—Ü–µ–Ω–∞—Ä–∏–π, –ø–æ—Ö–æ–∂–∏–π –Ω–∞ –Ω–∞—à, —Ç—Ä–µ–±—É–µ—Ç—Å—è —á—Ç–æ–±—ã –≤–µ–±-—Å–µ—Ä–≤–µ—Ä **SPA** "—Ä–∞–∑—Ä–µ—à–∞–ª" –∑–∞–ø—Ä–æ—Å—ã –∫ **API**, –æ—Ç–ø—Ä–∞–≤–ª—è—è –≤ –±—Ä–∞—É–∑–µ—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∑–∞–≥–æ–ª–æ–≤–∫–∏ —Å –Ω—É–∂–Ω—ã–º —Å–∞–π—Ç–æ–º.

üí° CORS - –æ–¥–Ω–∞ –∏–∑ –º–Ω–æ–≥–∏—Ö —Ç–µ–º, —Ç–∏–ø–∞ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ SSL/TLS, –∫–æ—Ç–æ—Ä—ã–µ –º—ã –Ω–µ –±—É–¥–µ–º –≤–∫–ª—é—á–∞—Ç—å —ç—Ç–æ—Ç —Ç—É—Ç–æ—Ä–∏–∞–ª —á—Ç–æ–±—ã –æ–Ω –Ω–µ —Ä–∞–∑—Ä–æ—Å—Å—è –Ω–∞ 100 —Å—Ç—Ä–∞–Ω–∏—Ü. –ù–∞ –¥–∞–Ω–Ω–æ–º —ç—Ç–∞–ø–µ –Ω–∞–º –±—ã–ª–æ –≤–∞–∂–Ω–æ —É–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ –æ–±–∞ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è —Ä–∞–±–æ—Ç–∞—é—Ç. –ö–æ–≥–¥–∞ –º—ã —Ä–∞–∑–≤–µ—Ä–Ω—ë–º –Ω–∞—à–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤ **Kubernetes**, –º—ã —Å–º–æ–∂–µ–º –ø–æ–ª—É—á–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã –∫ **SPA** –∏ **API** –Ω–∞ –æ–¥–∏–Ω –¥–æ–º–µ–Ω –∏ –ø–æ—Ä—Ç –∏ —Ä–∞–∑–ª–∏—á–∞—Ç—å –∏—Ö –Ω–∞ –æ—Å–Ω–æ–≤–µ `path`.

üí° –î–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —É—Ç–∏–ª–∏—Ç–∞ `docker-compose`. –ú—ã –º–æ–≥–ª–∏ –±—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –µ—ë —á—Ç–æ–±—ã —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ **SPA** –∏ **API**, –∞ —Ç–∞–∫–∂–µ –∏—Ö –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å –≤–Ω–µ—à–Ω–∏–º –º–∏—Ä–æ–º —á–µ—Ä–µ–∑ –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–π reverse proxy. `docker-compose` —Ç–µ—Å–Ω–æ —Å–≤—è–∑–∞–Ω —Å –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º [**Docker Swarm**](https://docs.docker.com/engine/swarm/), –ø—Ä–æ–¥—É–∫—Ç–æ–º **Docker**, –∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ñ–∞–π–ª—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ —Å —Å–æ–≤–º–µ—Å—Ç–∏–º—ã–º —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–æ–º. –ü–æ —Ç–æ–π –ø—Ä–∏—á–∏–Ω–µ —á—Ç–æ –≤ –∫–∞—á–µ—Å—Ç–≤–µ –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –º—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º **Kubernetes**, –º—ã –±—É–¥–µ–º –≤—ã–ø–æ–ª–Ω—è—Ç—å –Ω–∞—à–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ª–æ–∫–∞–ª—å–Ω–æ —Å—Ä–∞–∑—É –≤ **Kubernetes**.

## ‚ò∏Ô∏è –†–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏–µ –≤ Kubernetes

–ú—ã —É–∂–µ –Ω–∞—É—á–∏–ª–∏—Å—å –∑–∞–ø—É—Å–∫–∞—Ç—å –Ω–∞—à–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤ Docker, –ø–µ—Ä–µ–π–¥—ë–º —Ç–µ–ø–µ—Ä—å –∫ —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏—é –≤ Kubernetes.

![–†–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏–µ –≤ Kubernetes](img/local_kubernetes_800.png)

–ï—Å–ª–∏ –≤—ã –µ—â–µ –Ω–µ –∑–Ω–∞–∫–æ–º—ã —Å Kubernetes, —Ç–æ —è –±—ã —Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–ª —ç—Ç–∏ –º–∞—Ç–µ—Ä–∏–∞–ª—ã.
- [What is Kubernetes?](https://kubernetes.io/docs/concepts/overview/what-is-kubernetes/)
- –î—Ä—É–≥–∏–µ —Ç–µ–º—ã [Kubernetes Documentation -> Concepts -> Overview](https://kubernetes.io/docs/concepts/overview/)
- –¢—É—Ç–æ—Ä–∏–∞–ª [Learn Kubernetes Basics](https://kubernetes.io/docs/tutorials/kubernetes-basics/).

–î–ª—è –∑–Ω–∞–∫–æ–º—Å—Ç–≤–∞ —Å –æ—Å–Ω–æ–≤–∞–º–∏ –∫–∞–∫ –ø—Ä–∞–≤–∏–ª–æ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–∏—Å—Ç—Ä–∏–±—É—Ü–∏–∏ Kubernetes, –ø–æ—Å—Ç–∞–≤–ª—è–µ–º–æ–π –≤–º–µ—Å—Ç–µ —Å Docker Desktop.

### –†–∞–∑–≤–µ—Ä–Ω—ë–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ª–æ–∫–∞–ª—å–Ω–æ –≤ Kubernetes –Ω–∞ Docker Desktop

üí° –ï—Å–ª–∏ —É –≤–∞—Å –Ω–µ –ø–æ–ª—É—á–∏—Ç—Å—è —Å–æ–∑–¥–∞—Ç—å –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —Ä–µ—Å—É—Ä—Å—ã –∏–∑-–∑–∞ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏—Ö —Å–ª–æ–∂–Ω–æ—Å—Ç–µ–π, –≤—ã –º–æ–∂–µ—Ç–µ –ª–∏–±–æ –∑–∞–Ω—è—Ç—å—Å—è –æ—Ç–ª–∞–¥–∫–æ–π –∫–æ—Ç–æ—Ä–∞—è –ø–æ—Ç—Ä–µ–±—É–µ—Ç –æ—Å–Ω–æ–≤–∞—Ç–µ–ª—å–Ω–æ –≤–æ –≤—Å—ë–º —Ä–∞–∑–æ–±—Ä–∞—Ç—å—Å—è –ª–∏–±–æ –ø–µ—Ä–µ–π—Ç–∏ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —Ä–∞–∑–¥–µ–ª—É –≥–¥–µ –º—ã –±—É–¥–µ–º –ø–æ—Ö–æ–∂–∏–º –æ–±—Ä–∞–∑–æ–º —Ä–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞—Ç—å –Ω–∞—à–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤ Kubernetes –Ω–æ –Ω–∞ Google Kubernetes Engine (GKE). –í –¥—Ä—É–≥–æ–π —Å—Ä–µ–¥–µ —Ç–µ –∂–µ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã –º–æ–≥—É—Ç –Ω–µ –≤–æ–∑–Ω–∏–∫–Ω—É—Ç—å. 

–°–æ–∑–¥–∞–¥–∏–º –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é, –≤ –∫–æ—Ç–æ—Ä–æ–π –º—ã –±—É–¥–µ–º —Ö—Ä–∞–Ω–∏—Ç—å —Ñ–∞–π–ª—ã —Ä–µ—Å—É—Ä—Å–æ–≤ Kubernetes. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –∫–æ—Ä–µ–Ω—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –∫–æ–º–∞–Ω–¥—É.
```bash
mkdir kubernetes
```

–ù–∞—à–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ä–∞–∑–≤—ë—Ä–Ω—É—Ç–æ–µ –≤ Kubernetes –≤ Docker Desktop –±—É–¥–µ—Ç –≤—ã–≥–ª—è–¥–µ—Ç—å —Ç–∞–∫.

üõ†Ô∏è –ù–∞—á–Ω—ë–º —Å **SPA**. –î–æ–±–∞–≤–∏–º —Ñ–∞–π–ª `./kubernetes/spa.yml` —Å —Ç–∞–∫–∏–º –∫–æ–¥–æ–º.

```yaml
kind: Deployment
apiVersion: apps/v1
metadata:
  name: gitlab-course-spa
  namespace: gitlab-course
  labels:
    k8s-app: gitlab-course-spa
    project: gitlab-course
spec:
  replicas: 1
  selector:
    matchLabels:
      k8s-app: gitlab-course-spa
  template:
    metadata:
      name: gitlab-course-spa
      labels:
        k8s-app: gitlab-course-spa
    spec:
      containers:
      - name: gitlab-course-spa
        # —Ç–∞–∫ –º—ã –Ω–∞–∑–≤–∞–ª–∏ –Ω–∞—à docker image
        image: gitlab-course-spa
        imagePullPolicy: IfNotPresent
---
kind: Service
apiVersion: v1
metadata:
  name: gitlab-course-spa
  namespace: gitlab-course
  labels:
    k8s-app: gitlab-course-spa
    project: gitlab-course
spec:
  ports:
  - protocol: TCP
    port: 80
    targetPort: 80
  selector:
    k8s-app: gitlab-course-spa
```

–î–∞–Ω–Ω—ã–π —Ñ–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç –¥–≤–∞ YAML-–¥–æ–∫—É–º–µ–Ω—Ç–∞ —Ä–∞–∑–¥–µ–ª—ë–Ω–Ω—ã—Ö `---`. 
- –ü–µ—Ä–≤—ã–π –¥–æ–∫—É–º–µ–Ω—Ç –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç [Deployment](https://kubernetes.io/docs/concepts/workloads/controllers/deployment/) –¥–ª—è **SPA**. Deployment –≤ –¥–∞–Ω–Ω–æ–º —Å–ª—É—á–∞–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ç–æ–º –∫–∞–∫–∏–µ Pods —Å –∫–∞–∫–∏–º–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞–º–∏ –∏ –≤ –∫–∞–∫–æ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ –º—ã —Ö–æ—Ç–∏–º –≤—ã–ø–æ–ª–Ω—è—Ç—å. Kubernetes –ø–æ–ª–∞–≥–∞–µ—Ç—Å—è –Ω–∞ `labels` –¥–ª—è —Ç–æ–≥–æ —á—Ç–æ–±—ã –ø–æ–Ω—è—Ç—å –∫–∞–∫–∏–µ Pods –æ—Ç–Ω–æ—Å—è—Ç—Å—è –∫ –Ω–∞—à–µ–º—É Deployment. –í –¥–∞–Ω–Ω–æ–º —Å–ª—É—á–∞–µ –≤ –ø–æ–ª–µ `selector` –º—ã —É–∫–∞–∑—ã–≤–∞–µ–º —á—Ç–æ —ç—Ç–æ Pods c `k8s-app: gitlab-course-spa`. –ú—ã —Å–æ–±–∏—Ä–∞–µ–º –æ–±—Ä–∞–∑ –ª–æ–∫–∞–ª—å–Ω–æ, –ø–æ—ç—Ç–æ–º—É –ø—Ä–∏ `imagePullPolicy: IfNotPresent` –≤ —Å–ª—É—á–∞–µ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏—è –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –ª–æ–∫–∞–ª—å–Ω–∞—è –∫–æ–ø–∏—è –æ–±—Ä–∞–∑–∞.
- –í—Ç–æ—Ä–æ–π –¥–æ–∫—É–º–µ–Ω—Ç –∑–∞–¥–∞—ë—Ç [Service](https://kubernetes.io/docs/concepts/services-networking/service/) –¥–ª—è **SPA**. Service –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –∫–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º –Ω–∞—à–∏ Pods –±—É–¥—É—Ç –¥–æ—Å—Ç—É–ø–Ω—ã –∫–∞–∫ —Å–µ—Ç–µ–≤–æ–π —Ä–µ—Å—É—Ä—Å.

üí° –ú—ã –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ –æ–ø—Ä–µ–¥–µ–ª—è–µ–º –º–µ—Ç–∫—É `project: gitlab-course` –¥–ª—è –≤—Å–µ—Ö —Ä–µ—Å—É—Ä—Å–æ–≤ –Ω–∞—à–µ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞ —á—Ç–æ–±—ã –≤ –¥–∞–ª—å–Ω–µ–π—à–µ–º –∏–º–µ—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø–æ–ª—É—á–∞—Ç—å –∏—Ö –≤—Å–µ—Ö –∑–∞–ø—Ä–æ—Å–æ–º –ø–æ `label` –≤—Ä–æ–¥–µ —Ç–∞–∫–æ–≥–æ:
```bash
kubectl get all --selector=project=gitlab-course -n gitlab-course
``` 

üõ†Ô∏è –ö–∞–∂–µ—Ç—Å—è —á—Ç–æ —É –Ω–∞—Å –µ—Å—Ç—å –≤—Å—ë —á—Ç–æ–±—ã —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—å **SPA**, –æ–¥–Ω–∞–∫–æ –µ—Å—Ç—å –æ–¥–∏–Ω –Ω—é–∞–Ω—Å. –î–µ–ª–æ –≤ —Ç–æ–º, —á—Ç–æ –º—ã –æ–±—Ä–∞—â–∞–ª–∏—Å—å –∫ **API** –ø–æ –∞–¥—Ä–µ—Å—É, –∑–∞–¥–∞–Ω–Ω–æ–º—É —á–µ—Ä–µ–∑ `API_URL`, –∏ —ç—Ç–æ –∑–Ω–∞—á–µ–Ω–∏–µ –≤—Å—Ç—Ä–æ–µ–Ω–æ –≤ –æ–±—Ä–∞–∑ **SPA**. –ü–µ—Ä–µ—Å–æ–±–µ—Ä—ë–º –æ–±—Ä–∞–∑, –∏—Å–ø–æ–ª—å–∑—É—è –∑–Ω–∞—á–µ–Ω–∏–µ `API_URL`, –∫–æ—Ç–æ—Ä–æ–µ –º—ã –±—É–¥–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ –¥–∞–ª—å–Ω–µ–π—à–µ–º.
```bash
docker build ./spa --build-arg API_URL=http://spa.localtest.me/log -t gitlab-course-spa
```

üõ†Ô∏è –°–æ–∑–¥–∞–¥–∏–º —Ä–µ—Å—É—Ä—Å—ã **SPA** –≤—ã–ø–æ–ª–Ω–∏–≤ –∫–æ–º–∞–Ω–¥—É
```bash
kubectl apply -f kubernetes/spa.yml
```
–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤ –∫–æ–Ω—Å–æ–ª–∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç—Å—è —á—Ç–æ –æ–±–∞ —Ä–µ—Å—É—Ä—Å–∞ —Å–æ–∑–¥–∞–Ω—ã.

üí° –ï—Å–ª–∏ –≤—ã –∑–∞—Ö–æ—Ç–∏—Ç–µ –æ–±–Ω–æ–≤–∏—Ç—å –æ–±—Ä–∞–∑ Pod –≤ Kubernetes, –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è —ç—Ç–æ—Ç Pod –ø–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å. –î–ª—è **SPA** —ç—Ç–æ –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å, –Ω–∞–ø—Ä–∏–º–µ—Ä, —ç—Ç–æ–π –∫–æ–º–∞–Ω–¥–æ–π.
```bash
kubectl rollout restart deployment gitlab-course-api -n gitlab-course
```

üõ†Ô∏è –ü–µ—Ä–µ–π–¥—ë–º –∫ **API**. –î–æ–±–∞–≤–∏–º —Ñ–∞–π–ª `./kubernetes/api.yml` —Å —Ç–∞–∫–∏–º –∫–æ–¥–æ–º.
```yaml
kind: Deployment
apiVersion: apps/v1
metadata:
  name: gitlab-course-api
  namespace: gitlab-course
  labels:
    k8s-app: gitlab-course-api
    project: gitlab-course
spec:
  replicas: 1
  selector:
    matchLabels:
      k8s-app: gitlab-course-api
  template:
    metadata:
      name: gitlab-course-api
      labels:
        k8s-app: gitlab-course-api
    spec:
      containers:
      - name: gitlab-course-api
        # this is how we named our docker image
        image: gitlab-course-api
        imagePullPolicy: IfNotPresent
        volumeMounts:
        - name: gitlab-course-pv
          mountPath: /app/data
      volumes:
      - name: gitlab-course-pv
        persistentVolumeClaim:
          claimName: gitlab-course-pv-claim
---
kind: Service
apiVersion: v1
metadata:
  name: gitlab-course-api
  namespace: gitlab-course
  labels:
    k8s-app: gitlab-course-api
    project: gitlab-course
spec:
  ports:
  - protocol: TCP
    port: 80
    targetPort: 4000
  selector:
    k8s-app: gitlab-course-api
```

–¢—É—Ç –≤—Å—ë –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ **SPA** –∫—Ä–æ–º–µ —ç—Ç–æ–π —á–∞—Å—Ç–∏:
```yaml
...
        volumeMounts:
        - name: gitlab-course-pv
          mountPath: /app/data
      volumes:
      - name: gitlab-course-pv
          persistentVolumeClaim:
            claimName: gitlab-course-pv-claim
...
```

–û–Ω–∞ —Å–≤—è–∑–∞–Ω–∞ —Å —Ç–µ–º —á—Ç–æ –º—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º Persistent Volumes –¥–ª—è —Ç–æ–≥–æ —á—Ç–æ–±—ã –¥–∞–Ω–Ω—ã–µ, —Å–æ—Ö—Ä–∞–Ω—è–µ–º—ã–µ **API** –º–æ–≥–ª–∏ –∂–∏—Ç—å –¥–æ–ª—å—à–µ —á–µ–º Pod. 
- –í `volumes` –º—ã –æ–±—ä—è–≤–ª—è–µ–º –Ω–æ–≤—ã–π –¥–∏—Å–∫ –∏ —É–∫–∞–∑—ã–≤–∞–µ–º —á—Ç–æ —Ä–µ—Å—É—Ä—Å—ã –¥–ª—è –Ω–µ–≥–æ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –ø–æ–ª—É—á–µ–Ω—ã —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º Persistent Volume Claim `gitlab-course-pv-claim`.
- –í `volumeMounts` –º—ã –º–æ–Ω—Ç–∏—Ä—É–µ–º —ç—Ç–æ—Ç –¥–∏—Å–∫ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é `/app/data` –≥–¥–µ –Ω–∞—à–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ö—Ä–∞–Ω–∏—Ç –¥–∞–Ω–Ω—ã–µ.

–û–¥–Ω–∞–∫–æ –¥–ª—è —Ç–æ–≥–æ —á—Ç–æ–±—ã —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–ª–æ, –Ω–∞–º —Ç—Ä–µ–±—É–µ—Ç—Å—è —á—Ç–æ–±—ã —É–∂–µ –¥–æ —ç—Ç–æ–≥–æ –±—ã–ª –æ–ø—Ä–µ–¥–µ–ª—ë–Ω Persistent Volume Claim `gitlab-course-pv-claim`.

üõ†Ô∏è –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π —Ñ–∞–π–ª `./kubernetes/volume.yml` —Å —Ç–∞–∫–∏–º –∫–æ–¥–æ–º.
```yaml
apiVersion: storage.k8s.io/v1
kind: StorageClass
metadata:
  name: local-storage
provisioner: kubernetes.io/no-provisioner
reclaimPolicy: Delete
volumeBindingMode: Immediate
---
apiVersion: v1
kind: PersistentVolume
metadata:
  name: gitlab-course-pv
  labels:
    k8s-app: gitlab-course-api
    project: gitlab-course
spec:
  capacity:
    storage: 100Mi
  volumeMode: Filesystem
  accessModes:
  - ReadWriteOnce
  persistentVolumeReclaimPolicy: Delete
  storageClassName: local-storage
  local:
    # –¥–∞–Ω–Ω—ã–π –ø—É—Å—Ç—å —Å–ø–µ—Ü–∏—Ñ–∏—á–µ–Ω –¥–ª—è Linux subsistem for Windows –∏ —Ç—Ä–∞–Ω—Å–ª–∏—Ä—É–µ—Ç—Å—è –≤
    # C:\volumes\data\gitlab-course
    # —ç—Ç–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —Å–æ–∑–¥–∞–Ω–∞ –ø–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º –¥–∏—Å–∫–∞
    path: "/run/desktop/mnt/host/c/volumes/data/gitlab-course"
  nodeAffinity:
    required:
      nodeSelectorTerms:
      - matchExpressions:
        - key: kubernetes.io/os
          operator: In
          values:
          - linux
---
kind: PersistentVolumeClaim
apiVersion: v1
metadata:
  name: gitlab-course-pv-claim
  labels:
    k8s-app: gitlab-course-api
    project: gitlab-course
spec:
  accessModes:
  - ReadWriteOnce
  resources:
    requests:
      storage: 100Mi
  storageClassName: local-storage
  volumeName: gitlab-course-pv

```

–≠—Ç–æ, –ø–æ–∂–∞–ª—É–π, —Å–∞–º—ã–π —Å–∫—É—á–Ω—ã–π –º–æ–º–µ–Ω—Ç —Ç—É—Ç–æ—Ä–∏–∞–ª–∞, –Ω–æ –∑–∞—Ç–æ –¥–∞–ª—å—à–µ —Ç–∞–∫ —Å–∫—É—á–Ω–æ —É–∂–µ –Ω–µ –±—É–¥–µ—Ç. –ò—Ç–∞–∫, —Ä–∞–∑–±–µ—Ä—ë–º—Å—è —á—Ç–æ —Ç—É—Ç –∏ –∑–∞—á–µ–º.
–ù–∞—á–Ω—ë–º —Å `PersistentVolumeClaim` —Å –∏–º–µ–Ω–µ–º `gitlab-course-pv-claim`. –û–Ω –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –Ω–µ–∫–∏–π –∑–∞–ø—Ä–æ—Å –Ω–∞ —Ä–µ—Å—É—Ä—Å—ã –∏ –º—ã —É–∫–∞–∑—ã–≤–∞–µ–º –µ–≥–æ –≤ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–∏ **SPA**. Kubernetes —Ä–∞—Å—à–∏—Ä—è–µ–º–∞—è —Å–∏—Å—Ç–µ–º–∞, –∏ –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç–∏, –≤ –Ω–∞—à–µ–º —Å–ª—É—á–∞–µ `100MiB`, –º–æ–≥—É—Ç –±—ã—Ç—å —É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–µ–Ω—ã —Ä–∞–∑–Ω—ã–º –æ–±—Ä–∞–∑–æ–º, –Ω–∞–ø—Ä–∏–º–µ—Ä –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ–º –æ–±–ª–∞—á–Ω–æ–≥–æ —Ä–µ—Å—É—Ä—Å–∞. –¢–∞–∫ –∫–∞–∫ –º—ã –ø—É–±–ª–∏–∫—É–µ–º –Ω–∞—à–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ª–æ–∫–∞–ª—å–Ω–æ, –º—ã –ø–æ–ø—Ä–æ—Å—Ç—É —Å–æ–∑–¥–∞—ë–º `PersistentVolume` —Å –Ω–∞–∑–≤–∞–Ω–∏–µ–º `gitlab-course-pv` —á—É—Ç—å –≤—ã—à–µ. –ß—Ç–æ–±—ã —Å–æ–∑–¥–∞—Ç—å `PersistentVolume` —Ç—Ä–µ–±—É–µ—Ç—Å—è, –≤ —Å–≤–æ—é –æ—á–µ—Ä–µ–¥—å, —É–∫–∞–∑–∞—Ç—å storage class –∫–æ—Ç–æ—Ä—ã–π —Å–æ–¥–µ—Ä–∂–∏—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ç–æ–º, –∫–∞–∫–æ–≥–æ —Ä–æ–¥–∞ –¥–∏—Å–∫ –Ω–∞–º —Ç—Ä–µ–±—É–µ—Ç—Å—è. –ü–æ—ç—Ç–æ–º—É –µ—â—ë –≤—ã—à–µ –º—ã —Å–æ–∑–¥–∞—ë–º storage class —Å `storageClassName: local-storage`, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–¥—Ä–∞–∑—É–º–µ–≤–∞–µ—Ç —á—Ç–æ –¥–∏—Å–∫ —Å–æ–∑–¥–∞–Ω –≤—Ä—É—á–Ω—É—é.


üõ†Ô∏è –ü—Ä–∏–º–µ–Ω–∏—Ç–µ –ø—Ä–∏–≤–µ–¥—ë–Ω–Ω—É—é –≤—ã—à–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é.
```bash
kubectl apply -f kubernetes/volume.yml
```
–£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ –∫–æ–Ω—Å–æ–ª–∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç —á—Ç–æ –≤—Å–µ —Ç—Ä–∏ –æ–±—ä–µ–∫—Ç–∞ —Å–æ–∑–¥–∞–Ω—ã.

üõ†Ô∏è –¢–µ–ø–µ—Ä—å —É –Ω–∞—Å –µ—Å—Ç—å –≤—Å—ë —á—Ç–æ–±—ã —Å–æ–∑–¥–∞—Ç—å –æ–±—ä–µ–∫—Ç—ã **API**.
```bash
kubectl apply -f kubernetes/api.yml
```

–ù–∞—à–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã —É–∂–µ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –≤ Kubernetes, –Ω–æ —Å–µ—Ä–≤–∏—Å—ã, –∫–æ—Ç–æ—Ä—ã–µ –º—ã —Å–æ–∑–¥–∞–ª–∏ –¥–æ—Å—Ç—É–ø–Ω—ã –ª–∏—à—å –∏–∑ –ª–æ–∫–∞–ª—å–Ω–æ–π —Å–µ—Ç–∏ –≤–Ω—É—Ç—Ä–∏ Kubernetes. –û–¥–Ω–∏–º –∏–∑ —Å–ø–æ—Å–æ–±–æ–≤ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ –Ω–∞—à–µ–º—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é –∏–∑–≤–Ω–µ —è–≤–ª—è–µ—Ç—Å—è —Å–æ–∑–¥–∞–Ω–∏–µ –æ–±—ä–µ–∫—Ç–∞ –∫–æ—Ç–æ—Ä—ã–π –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è Ingress. Ingress –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –ø—Ä–∞–≤–∏–ª–∞ –ø–æ –∫–æ—Ç–æ—Ä—ã–º –Ω–∞—à–∏ —Å–µ—Ä–≤–∏—Å—ã –±—É–¥—É—Ç –¥–æ—Å—Ç—É–ø–Ω—ã –ø–æ HTTP. 

üí° –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –≤ –≤–∞—à–µ–π –≤–µ—Ä—Å–∏–∏ Kubernetes —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω ingress controller, –Ω–∞–ø—Ä–∏–º–µ—Ä –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–π —Å–æ–æ–±—â–µ—Å—Ç–≤–æ–º `ingress-nginx`. –ï—Å–ª–∏ –≤—ã –Ω–µ –º–æ–∂–µ—Ç–µ –Ω–∞–π—Ç–∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π Deployment, –≤–∞–º –º–æ–∂–µ—Ç –ø–æ–Ω–∞–¥–æ–±–∏—Ç—å—Å—è [—É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –µ–≥–æ](https://kubernetes.github.io/ingress-nginx/deploy/). –ù–∞ –º–æ–º–µ–Ω—Ç –Ω–∞–ø–∏—Å–∞–Ω–∏—è —ç—Ç–æ–π —Å—Ç–∞—Ç—å—è –∫–æ–º–∞–Ω–¥–∞ –¥–ª—è Docker Desktop –≤—ã–≥–ª—è–¥–µ–ª–∞ —Ç–∞–∫
```bash
kubectl apply -f https://raw.githubusercontent.com/kubernetes/ingress-nginx/controller-v1.0.4/deploy/static/provider/cloud/deploy.yaml
```

üõ†Ô∏è –°–æ–∑–¥–∞–¥–∏–º —Ñ–∞–π–ª `kubernetes/ingress.yml` —Å —Ç–∞–∫–∏–º –∫–æ–¥–æ–º. 
```yaml
kind: Ingress
apiVersion: networking.k8s.io/v1
metadata:
  name: gitlab-course-ingress
  namespace: gitlab-course
  labels:
    project: gitlab-course
spec:
  rules:
    - host: spa.localtest.me
      http:
        paths:
          - path: /log
            pathType: Prefix
            backend:
              service:
                name: gitlab-course-api
                port:
                  number: 80
  defaultBackend:
    service:
      name: gitlab-course-spa
      port:
        number: 80
```

–í –Ω–∞—à–µ–º —Å–ª—É—á–∞–µ –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ —Å–æ–∑–¥–∞–Ω–∏—è –æ–±—ä–µ–∫—Ç–∞ Ingress –±—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω reverse-proxy –Ω–∞ –æ—Å–Ω–æ–≤–µ nginx, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç –æ—Å—É—â–µ—Å—Ç–≤–ª—è—Ç—å –ø–µ—Ä–µ–¥–∞—á—É –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ —Å–µ—Ä–≤–∏—Å–∞–º –Ω–∞—à–µ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∏ –æ—Ç–≤–µ—Ç–æ–≤ –æ—Ç –Ω–∏—Ö –æ–±—Ä–∞—Ç–Ω–æ –∫–ª–∏–µ–Ω—Ç—É. –°—É—Ç—å –¥–∞–Ω–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –≤ —Ç–æ–º —á—Ç–æ –º—ã –ø—Ä–∏–Ω–∏–º–∞–µ–º –∑–∞–ø—Ä–æ—Å—ã –Ω–∞ –ø–æ—Ä—Ç—É 80 –∏ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º –≤—Å–µ –∑–∞–ø—Ä–æ—Å—ã –Ω–∞ **SPA** –ø–æ–º–∏–º–æ –∑–∞–ø—Ä–æ—Å–æ–≤ –ø–æ –∞–¥—Ä–µ—Å—É `http://spa.localtest.me/log`, –∫–æ—Ç–æ—Ä—ã–µ –º—ã –Ω–∞–ø—Ä–∞–≤–ª—è–µ–º –∫ **API**. –ú—ã —Ç—É—Ç –∏—Å–ø–æ–ª—å–∑—É–µ–º `localtest.me` - –¥–æ–º–µ–Ω–Ω–æ–µ –∏–º—è –¥–ª—è –∫–æ—Ç–æ—Ä–æ–≥–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è IP `127.0.0.1` –¥–ª—è –≤—Å–µ—Ö –ø–æ–¥–¥–æ–º–µ–Ω–æ–≤.

üõ†Ô∏è –°–æ–∑–¥–∞–π—Ç–µ —Ä–µ—Å—É—Ä—Å Ingress.
```bash
kubectl apply -f kubernetes/ingress.yml
```

üõ†Ô∏è –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ –ø–æ –∞–¥—Ä–µ—Å—É `http://spa.localtest.me`. –í–∞–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏–º–µ–Ω–Ω–æ —ç—Ç–æ—Ç –¥–æ–º–µ–Ω –ø–æ—Ç–æ–º—É –¥–ª—è –¥—Ä—É–≥–æ–≥–æ –∑–∞–ø—Ä–æ—Å –∫ **API** –ø–æ –∞–¥—Ä–µ—Å—É `http://spa.localtest.me/log` –±—É–¥–µ—Ç –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω CORS.

üëç –ü–æ–∑–¥—Ä–∞–≤–ª—è—é, –≤—ã —Ä–∞–∑–≤–µ—Ä–Ω—É–ª–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤ Kubernetes, —Ö–æ—Ç—å –ø–æ–∫–∞ –∏ –ª–æ–∫–∞–ª—å–Ω–æ. –ö–∞–∫ –º—ã —É–≤–∏–¥–∏–º –≤ –¥–∞–ª—å–Ω–µ–π—à–µ–º, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –¥—Ä—É–≥–æ–≥–æ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ –Ω–µ –±—É–¥–µ—Ç –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ —Å–ª–æ–∂–Ω–µ–µ.

## ‚òÅÔ∏è –†–∞–∑–≤–µ—Ä–Ω—ë–º –Ω–∞—à–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤ GCP

![–†–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏–µ –Ω–∞ GKE –≤—Ä—É—á–Ω—É—é](img/manual_gke_800.png)

### –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞ –≤ GitLab

–ú—ã –±—É–¥–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å GitLab.com –≤ –∫–∞—á–µ—Å—Ç–≤–µ –∏–Ω—Å—Ç–∞–ª–ª—è—Ü–∏–∏ GitLab —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å —Ö–ª–æ–ø–æ—Ç –ø–æ —É—Å—Ç–∞–Ω–æ–≤–∫–µ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ –ª–æ–∫–∞–ª—å–Ω–æ–π –≤–µ—Ä—Å–∏–∏.

üõ†Ô∏è –ï—Å–ª–∏ —É –≤–∞—Å –µ—â—ë –Ω–µ—Ç —É—á—ë—Ç–Ω–æ–π –∑–∞–ø–∏—Å–∏ –Ω–∞ GitLab.com, –∑–∞–π–¥–∏—Ç–µ –Ω–∞ https://gitlab.com –∏ –∑–∞–≤–µ–¥–∏—Ç–µ –µ—ë.

GitLab –ø–æ–∑–≤–æ–ª—è–µ—Ç –Ω–∞–º —Å–æ–∑–¥–∞—Ç—å –ø—Ä–æ–µ–∫—Ç –ø—Ä–æ—Å—Ç–æ –≤—ã–ø–æ–ª–Ω–∏–≤ push –≤ —É–¥–∞–ª—ë–Ω–Ω—ã–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π.

üõ†Ô∏è –í–æ—Å–ø–æ–ª—å–∑—É–µ–º—Å—è –¥–ª—è —ç—Ç–æ–≥–æ —Å–ª–µ–¥—É—é—â–µ–π –∫–æ–º–∞–Ω–¥–æ–π:
```bash
GITLAB_USER_NAME=<user name>
git push https://gitlab.com/<user name>/gitlab-kubernetes
```
`<user name>` —Ç—É—Ç - –≤–∞—à–µ –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–∞ GitLab.com. –î–∞–ª—å—à–µ –±—É–¥–µ–º —Å—á–∏—Ç–∞—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é `GITLAB_USER_NAME` –≤ –¥—Ä—É–≥–∏—Ö —Å–∫—Ä–∏–ø—Ç–∞—Ö –∏–º–µ—é—â–µ–π —Ç–æ –∂–µ –∑–Ω–∞—á–µ–Ω–∏–µ.

–≠—Ç–∞ –∫–æ–º–∞–Ω–¥–∞ —Å–æ–∑–¥–∞—Å—Ç –ø—Ä–∏–≤–∞—Ç–Ω—ã–π –ø—Ä–æ–µ–∫—Ç —Å –∏–º–µ–Ω–µ–º `gitlab-kubernetes` –≤–Ω—É—Ç—Ä–∏ –≤–∞—à–µ–π —É—á—ë—Ç–Ω–æ–π –∑–∞–ø–∏—Å–∏ –Ω–∞ GitLab.com.

GitLab –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –¥–æ—Å—Ç—É–ø –∫ "–ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏—è", –æ–¥–Ω–∞–∫–æ –¥–ª—è —ç—Ç–æ–≥–æ –Ω–∞—à–∞ –≤–µ—Ç–≤—å –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å "–∑–∞—â–∏—â—ë–Ω–Ω–æ–π" (protected). –ú—ã –æ—Å–Ω–æ–≤–∞—Ç–µ–ª—å–Ω–æ —Ä–∞–∑–±–µ—Ä—ë–º—Å—è —Å —ç—Ç–∏–º–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –ø–æ–∑–∂–µ, –Ω–æ —É–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ –Ω–∞—à–∞ –≤–µ—Ç–≤—å `master` protected –Ω–∞–º —É–¥–æ–±–Ω–µ–µ –≤—Å–µ–≥–æ –∏–º–µ–Ω–Ω–æ —Å–µ–π—á–∞—Å.

üõ†Ô∏è –ü—Ä–∏ –ø–æ–º–æ—â–∏ –±—Ä–∞—É–∑–µ—Ä–∞ –∑–∞–π–¥–∏—Ç–µ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –≤–∞—à–µ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞ –≤ GitLab `https://gitlab.com/<user name>/gitlab-kubernetes`;
- –í—ã–±–µ—Ä–∏—Ç–µ –≤ –º–µ–Ω—é —Å–ª–µ–≤–∞ **Settings** -> **Repository**;
- –†–∞–∑–≤–µ—Ä–Ω–∏—Ç–µ –ø–æ–¥–º–µ–Ω—é **Protected branches**;
- –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –≤–µ—Ç–≤—å `master` –ø–µ—Ä–µ—á–∏—Å–ª–µ–Ω–∞ –≤ —Å–ø–∏—Å–∫–µ, –∏ –≤ –∫–æ–ª–æ–Ω–∫–µ **Allowed to push** —É–∫–∞–∑–∞–Ω—ã —Ö–æ—Ç—è –±—ã **Maintainers** (–∑–Ω–∞—á–µ–Ω–∏–µ –Ω–µ —Ä–∞–≤–Ω–æ **No one**).
- –ï—Å–ª–∏ –≤–µ—Ç–≤—å `master` –≤ —Å–ø–∏—Å–∫–µ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç, –¥–æ–±–∞–≤—å—Ç–µ –µ—ë (**Protect**) —Å –≤—ã—à–µ—É–∫–∞–∑–∞–Ω–Ω—ã–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏.

### –°–æ–∑–¥–∞–Ω–∏–µ –∫–ª–∞—Å—Ç–µ—Ä–∞ Kubernetes –≤ GKE —á–µ—Ä–µ–∑ GitLab

üí° –î–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞—á –¥–∞–Ω–Ω–æ–π —á–∞—Å—Ç–∏ –º–æ–∂–µ—Ç –ø–æ–Ω–∞–¥–æ–±–∏—Ç—å—Å—è [—Å–æ–∑–¥–∞—Ç—å "–ø—Ä–æ–±–Ω—ã–π" –∞–∫–∫–∞—É–Ω—Ç](https://cloud.google.com/free). –í—ã –º–æ–∂–µ—Ç–µ –ø–æ–ª—É—á–∏—Ç—å $300 USD –Ω–∞ "–ø–æ–∏–≥—Ä–∞—Ç—å" —Å —Ä–µ—Å—É—Ä—Å–∞–º–∏ –Ω–∞ –ø—Ä–æ—Ç—è–∂–µ–Ω–∏–∏ –ø—Ä–æ–±–Ω–æ–≥–æ –ø–µ—Ä–∏–æ–¥–∞ –∏ [–¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ $200 USD](https://about.gitlab.com/partners/technology-partners/google-cloud-platform/) –µ—Å–ª–∏ –≤–æ—Å–ø–æ–ª—å–∑—É–µ—Ç–µ—Å—å –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ–º GitLab. –ü–æ –∫—Ä–∞–π–Ω–µ–π –º–µ—Ä–µ, —Ç–∞–∫–æ–≤—ã –±—ã–ª–∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –Ω–∞ –º–æ–º–µ–Ω—Ç –Ω–∞–ø–∏—Å–∞–Ω–∏—è —ç—Ç–æ–≥–æ —Ç—É—Ç–æ—Ä–∏–∞–ª–∞.

üí° "–ò–∑ –∫–æ—Ä–æ–±–∫–∏" GitLab —Ç–µ–ø–µ—Ä—å —Ç–∞–∫–∂–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é —Å Amazon EKS.

üõ†Ô∏è –°–æ–∑–¥–∞–π—Ç–µ –ø—Ä–æ–µ–∫—Ç —Å –Ω–∞–∑–≤–∞–Ω–∏–µ–º `gitlab-kubernetes` –≤ Google Cloud Platform. –ï—Å–ª–∏ –≤—ã –Ω–µ –¥–µ–ª–∞–ª–∏ —ç—Ç–æ —Ä–∞–Ω—å—à–µ, —Ç–æ [—Ç—É—Ç –Ω–∞–ø–∏—Å–∞–Ω–æ –∫–∞–∫](https://cloud.google.com/resource-manager/docs/creating-managing-projects). 

üí° –ù–∞ —Å–∞–º–æ–º –¥–µ–ª–µ –º–æ–∂–Ω–æ –≤–Ω–∞—á–∞–ª–µ —Å–æ–∑–¥–∞—Ç—å –∫–ª–∞—Å—Ç–µ—Ä –≤ Kubernetes, –∞ –∑–∞—Ç–µ–º —É–∫–∞–∑–∞—Ç—å –≤ GitLab –∫–ª—é—á –∏ —Ç–æ–∫–µ–Ω –Ω—É–∂–Ω–æ–≥–æ service account, –Ω–æ —ç—Ç–æ—Ç –ø—É—Ç—å —á—É—Ç—å –¥–ª–∏–Ω–Ω–µ–µ –∏ –≤ –±–æ–ª—å—à–µ–π —Å—Ç–µ–ø–µ–Ω–∏ –ø—Ä–æ–≤–æ—Ü–∏—Ä—É—é—Ç –æ—à–∏–±–∫–∏, –ø–æ—ç—Ç–æ–º—É –º—ã "—Å–∂—É–ª—å–Ω–∏—á–∞–µ–º" –∏ —Å–æ–∑–¥–∞–¥–∏–º –∫–ª–∞—Å—Ç–µ—Ä –≤ Kubernetes —Å—Ä–∞–∑—É –∏–∑ GitLab, —Ç–æ–≥–¥–∞ –≤—Å–µ —Ä–µ–∫–≤–∏–∑–∏—Ç—ã –±—É–¥—É—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.

üõ†Ô∏è –°–æ–∑–¥–∞–π—Ç–µ –∫–ª–∞—Å—Ç–µ—Ä Kubernetes —Å –Ω–∞–∑–≤–∞–Ω–∏–µ–º `gitlab-cluster-auto`. UI GitLab.com –ø–æ—Å—Ç–æ—è–Ω–Ω–æ –º–µ–Ω—è–µ—Ç—Å—è, –ø–æ—ç—Ç–æ–º—É –¥–µ–π—Å—Ç–≤–∏—è –º–æ–≥—É—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –æ—Ç–ª–∏—á–∞—Ç—å—Å—è, —Å–ª–µ–¥—É–π—Ç–µ –¥—É—Ö—É –∞ –Ω–µ –±—É–∫–≤–µ. –í –¥–∞–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç –¥–µ–π—Å—Ç–≤–∏—è —Ç–∞–∫–æ–≤—ã:
- –∑–∞–π–¥–∏—Ç–µ –≤ –ø—Ä–æ–µ–∫—Ç `gitlab-kubernetes`;
- –≤ –ª–µ–≤–æ–º –º–µ–Ω—é –≤—ã–±–µ—Ä–∏—Ç–µ **Infrastructure** -> **Kubernetes clusters**;
- –Ω–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É **Integrate with a cluster certificate** –≤ —Ü–µ–Ω—Ç—Ä–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã;
- —Å–ø—Ä–∞–≤–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –≤–∫–ª–∞–¥–∫—É **Create new cluster** -> **Google GKE**.

–î–∞–ª–µ–µ –∑–∞–ø–æ–ª–Ω–∏—Ç–µ —Ñ–æ—Ä–º—É.
- –£–∫–∞–∂–∏—Ç–µ `gitlab-cluster-auto` –≤ –∫–∞—á–µ—Å—Ç–≤–µ –Ω–∞–∑–≤–∞–Ω–∏—è –∫–ª–∞—Å—Ç–µ—Ä–∞
- –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –≤—ã–±—Ä–∞–Ω —Å–æ–∑–¥–∞–Ω–Ω—ã–π –¥–ª—è –∫—É—Ä—Å–∞ –ø—Ä–æ–µ–∫—Ç GCP `gitlab-kubernetes`
- –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ **Number of nodes** 1 - —ç—Ç–æ –¥–µ—à–µ–≤–ª–µ –∏ **API** –Ω–µ —Ä–∞—Å—Å—á–∏—Ç–∞–Ω –Ω–∞ –±–æ–ª—å—à–µ –æ–¥–Ω–æ–π —Ä–µ–ø–ª–∏–∫–∏.
- –ú–æ–∂–µ—Ç–µ –≤—ã–±—Ä–∞—Ç—å **Machine type** –ø–æ–º–µ–Ω—å—à–µ, –Ω–∞–ø—Ä–∏–º–µ—Ä `n1-standard-1`.
- –û—Å—Ç–∞–≤—å—Ç–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω–æ–π –æ–ø—Ü–∏—é **GitLab-managed cluster**.
- –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ –æ–ø—Ü–∏—è **Namespace per environment** - –º—ã –Ω–µ –±—É–¥–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–Ω–æ–≥–æ —Å—Ä–µ–¥, –Ω–æ –ø–æ–ª–µ–∑–Ω–æ –≤–∫–ª—é—á–∏—Ç—å —ç—Ç—É –æ–ø—Ü–∏—é –ø–æ—Ç–æ–º—É —á—Ç–æ —ç—Ç–æ –±–ª–∏–∂–µ –∫ "—Ä–µ–∞–ª—å–Ω–æ–π –∂–∏–∑–Ω–∏".

–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É **Create Kubernetes cluster**. –î–æ–∂–¥–∏—Ç–µ—Å—å –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –ø—Ä–æ—Ü–µ—Å—Å–∞, —É–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è —Å–æ–æ–±—â–µ–Ω–∏–µ **Kubernetes cluster was successfully created**.

üí° –ù–∞ –¥–∞–Ω–Ω–æ–º —ç—Ç–∞–ø–µ –º–æ–∂–µ—Ç –ø–æ–Ω–∞–¥–æ–±–∏—Ç—å—Å—è –∑–∞–π—Ç–∏ –≤ –≤–∞—à—É —É—á—ë—Ç–Ω—É—é –∑–∞–ø–∏—Å—å GCP –∏ –¥–∞—Ç—å GitLab –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è.

üõ†Ô∏è –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ **Kubernetes clusters** –Ω–∞–ø—Ä–æ—Ç–∏–≤ –Ω–∞—à–µ–≥–æ –∫–ª–∞—Å—Ç–µ—Ä–∞ `gitlab-cluster-auto` –Ω–µ—Ç –æ—à–∏–±–æ–∫.

üëç –¢–µ–ø–µ—Ä—å —É –Ω–∞—Å –µ—Å—Ç—å –∫–ª–∞—Å—Ç–µ—Ä Kubernetes –∫–æ—Ç–æ—Ä—ã–π –º—ã —Å–º–æ–∂–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ –¥–∞–ª—å–Ω–µ–π—à–µ–º.
### –†–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏–µ –≤ –öubernetes –Ω–∞ GCP "–≤—Ä—É—á–Ω—É—é"

üì¢ –ü—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å –∫–ª–∞—Å—Ç–µ—Ä–æ–º Kubernetes –≤ GCP –±—É–¥–µ–º –≤—ã–ø–æ–ª–Ω—è—Ç—å –∫–æ–Ω—Å–æ–ª—å–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã –≤ [Google Cloud Console Shell](https://shell.cloud.google.com). –≠—Ç–æ –ø–æ–∑–≤–æ–ª–∏—Ç
- —É–ø—Ä–æ—Å—Ç–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫—É –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –ø—Ä–∏ –¥–æ—Å—Ç—É–ø–µ –∫ –∫–ª–∞—Å—Ç–µ—Ä—É;
- —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –ª–æ–∫–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ `kubectl` –ø—Ä–µ–∂–Ω–∏–º–∏.

üõ†Ô∏è –û—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É [Google Cloud Shell](https://shell.cloud.google.com).

üõ†Ô∏è –í Google Cloud Shell —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω `kubectl`, –Ω–æ –Ω–∞–º –Ω—É–∂–Ω–æ "–ø–æ–¥–∫–ª—é—á–∏—Ç—å" –µ–≥–æ –∫ –∫–ª–∞—Å—Ç–µ—Ä—É. –î–ª—è —ç—Ç–æ–≥–æ –Ω–∞–º –ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è —É–∫–∞–∑–∞—Ç—å PROJECT_ID. –í—ã–≤–µ–¥–µ–º —Å–ø–∏—Å–æ–∫ –ø—Ä–æ–µ–∫—Ç–æ–≤ –≤ –Ω–∞—à–µ–º –æ–∫—Ä—É–∂–µ–Ω–∏–∏.
```bash
gcloud projects list
```
–ù–∞–ø—Ä–∏–º–µ—Ä, –¥–ª—è –º–µ–Ω—è PROJECT_ID –±—ã–ª `gitlab-kubernetes-326101`. –ü—Ä–∏—Å–≤–æ–π—Ç–µ —ç—Ç–æ –∑–Ω–∞—á–µ–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π PROJECT_ID
```bash
PROJECT_ID=<–≤–∞—à–µ –∑–Ω–∞—á–µ–Ω–∏–µ>
```

–¢–µ–ø–µ—Ä—å –º—ã –º–æ–∂–µ–º —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è `kubectl`.
```bash
gcloud container clusters get-credentials gitlab-cluster-auto --zone us-central1-a --project $PROJECT_ID
```
–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—ã–¥–∞—á–∞ –±—ã–ª–∞
```
Fetching cluster endpoint and auth data.
kubeconfig entry generated for gitlab-cluster-auto.
```

–°–æ–∑–¥–∞–¥–∏–º namespace `gitlab-course`
```bash
kubectl create namespace gitlab-course
```

–î–∞–≤–∞–π—Ç–µ –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞ —É—Å—Ç–∞–Ω–æ–≤–∏–º –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é `GITLAB_USER_NAME` –≤ Google Cloud Shell
```bash
GITLAB_USER_NAME=<user name>
```

üì¢ –ù–∞—á–Ω—ë–º —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏–µ –Ω–∞—à–µ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ GKE.
1. –°–æ–∑–¥–∞–¥–∏–º Persistent Volume Claim –¥–ª—è **API**. 
1. –†–∞–∑–≤–µ—Ä–Ω—ë–º **API**.
   - –ó–∞–≥—Ä—É–∑–∏–º –æ–±—Ä–∞–∑—ã **API** –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π GitLab.
   - C–æ–∑–¥–∞–¥–∏–º Deployment –∏ Service **API**.
1. –†–∞–∑–≤–µ—Ä–Ω—ë–º Ingress, –µ–º—É –±—É–¥–µ—Ç –ø—Ä–∏—Å–≤–æ–µ–Ω –≤–Ω–µ—à–Ω–∏–π IP –∞–¥—Ä–µ—Å. IP –∞–¥—Ä–µ—Å –Ω—É–∂–µ–Ω —á—Ç–æ–±—ã —É–∫–∞–∑–∞—Ç—å –∞–¥—Ä–µ—Å **API** –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –æ–±—Ä–∞–∑–∞ **SPA**.
   - –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–µ–º **API**
1. –†–∞–∑–≤–µ—Ä–Ω—ë–º **SPA**.
   - –ü–µ—Ä–µ—Å–æ–∑–¥–∞–¥–∏–º –æ–±—Ä–∞–∑ **SPA** —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –ø–æ–ª—É—á–µ–Ω–Ω–æ–≥–æ –∞–¥—Ä–µ—Å–∞ –∏ –∑–∞–≥—Ä—É–∑–∏–º –æ–±—Ä–∞–∑ **SPA** –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π GitLab.
   - –ù–∞–∫–æ–Ω–µ—Ü —Å–æ–∑–¥–∞–¥–∏–º Deployment –∏ Service –¥–ª—è **SPA**. 
   - –î–æ–±–∞–≤–∏–º –ø—Ä–∞–≤–∏–ª–æ –¥–ª—è **SPA** –≤ Ingress, –æ–±–Ω–æ–≤–∏–º Ingress. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–µ–º **SPA** –∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ü–µ–ª–∏–∫–æ–º.

<!-- TODO –Ω–∞—Ä–∏—Å–æ–≤–∞—Ç—å –Ω–∞ –¥–∏–∞–≥—Ä–∞–º–µ -->

#### –°–æ–∑–¥–∞–¥–∏–º Persistent Volume Claim –¥–ª—è **API**

üí° –ü—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å "–æ–±–ª–∞—á–Ω—ã–º–∏" –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞–º–∏ –æ–±—ã—á–Ω–æ —Ç—Ä–µ–±—É–µ—Ç—Å—è –ª–∏—à—å —Å–æ–∑–¥–∞—Ç—å Persistent Volume Claim, –∞ —Å–∞–º –¥–∏—Å–∫ –∏ —Ä–µ–∞–ª–∏–∑—É—é—â–∏–π –µ–≥–æ "–æ–±–ª–∞—á–Ω—ã–π" —Ä–µ—Å—É—Ä—Å —Å–æ–∑–¥–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å—Ä–µ–¥—Å—Ç–≤–∞–º–∏ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞.

üõ†Ô∏è –£–¥–∞–ª–∏—Ç–µ StorageClass –∏ PersistentVolume –≤ `kubernetes/volume.yml`. –£–¥–∞–ª–∏—Ç–µ `storageClassName: local-storage` –≤ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–∏ PersistentVolumeClaim, —ç—Ç–æ –ø—Ä–∏–≤–µ–¥—ë—Ç –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é [—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–≥–æ –¥–∏—Å–∫–∞ –≤ GKE](https://cloud.google.com/kubernetes-engine/docs/concepts/persistent-volumes). –¢–∞–∫–∂–µ –∑–∞–º–µ–Ω–∏–º –∑–Ω–∞—á–µ–Ω–∏–µ `namespace` –Ω–∞ —Ç–æ–∫–µ–Ω `{{NAMESPACE}}`.
```yml
kind: PersistentVolumeClaim
apiVersion: v1
metadata:
  name: gitlab-course-pv-claim
  namespace: {{NAMESPACE}}
  labels:
    k8s-app: gitlab-course-api
    project: gitlab-course
spec:
  accessModes:
  - ReadWriteOnce
  resources:
    requests:
      storage: 100Mi
```

üí° –ò–¥–µ—è –≤ —Ç–æ–º —á—Ç–æ `namespace` –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–æ–≥–æ –∫–∞–∫ –∏ –∫—É–¥–∞ –º—ã —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –º–æ–∂–µ—Ç –º–æ–∂–µ—Ç –±—ã—Ç—å —Ä–∞–∑–ª–∏—á–Ω—ã–º. –ü–æ —ç—Ç–æ–π –ø—Ä–∏—á–∏–Ω–µ –º—ã –±—É–¥–µ–º –∑–∞–º–µ–Ω—è—Ç—å `{{–¢–û–ö–ï–ù–´}}` –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –ø–µ—Ä–µ–¥ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ–º —Ñ–∞–π–ª–æ–≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏. –ú—ã –º–æ–≥–ª–∏ –±—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —á—Ç–æ-—Ç–æ —Ç–∏–ø–∞ Helm –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —à–∞–±–ª–æ–Ω–∞–º–∏, –Ω–æ –º—ã –∂–µ –Ω–µ —Ö–æ—Ç–∏–º —É—Å–ª–æ–∂–Ω—è—Ç—å —Ç—É—Ç–æ—Ä–∏–∞–ª, –Ω–µ —Ç–∞–∫ –ª–∏?

üõ†Ô∏è –ó–∞–≥—Ä—É–∑–∏—Ç–µ —ç—Ç–æ—Ç —Ñ–∞–π–ª –≤ Google Cloud Shell. –ö–Ω–æ–ø–∫–∞ "Upload" –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ –º–µ–Ω—é –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏ –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ Cloud Shell. –ù–∞ –º–æ–º–µ–Ω—Ç –Ω–∞–ø–∏—Å–∞–Ω–∏—è —ç—Ç–æ–≥–æ —Ç–µ–∫—Å—Ç–∞, –æ–ø—Ü–∏—è –Ω–∞—Ö–æ–¥–∏–ª–∞—Å—å –≤ –ø–æ–¥–º–µ–Ω—é "**‚ãÆ**". 
–ü–æ —Ç–æ–π –ø—Ä–∏—á–∏–Ω–µ —á—Ç–æ –º—ã —Ç–æ–∫–µ–Ω–∏–∑–∏—Ä–æ–≤–∞–ª–∏ —Ñ–∞–π–ª, –Ω–∞–º –Ω—É–∂–Ω–æ –≤–Ω–∞—á–∞–ª–µ –∑–∞–º–µ–Ω–∏—Ç—å —Ç–æ–∫–µ–Ω –Ω–∞ —Ä–µ–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ. 
–ù–∞–ø—Ä–∏–º–µ—Ä, —Ç–∞–∫
```bash
sed "s/{{NAMESPACE}}/gitlab-course/g" volume.yml > volume-replaced.yml
```
–ó–∞—Ç–µ–º –ø—Ä–∏–º–µ–Ω–∏—Ç–µ –ø–æ–ª—É—á–µ–Ω–Ω—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
```bash
kubectl apply -f volume-replaced.yml
```

–ò–ª–∏ –º–æ–∂–µ—Ç–µ –æ—Å—É—â–µ—Å—Ç–≤–∏—Ç—å –ø–æ–¥—Å—Ç–∞–Ω–æ–≤–∫—É –∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –æ–¥–Ω–æ–π —Å—Ç—Ä–æ—á–∫–æ–π.
```bash
sed "s/{{NAMESPACE}}/gitlab-course/g" volume.yml | kubectl apply -f -
```

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–ª–µ–¥—É—é—â–µ–π –∫–æ–º–∞–Ω–¥–æ–π —á—Ç–æ Persistent Volume Claim —Å–æ–∑–¥–∞–Ω.
```bash
kubectl get persistentvolumeclaim --all-namespaces
```

#### –†–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏–µ API

üõ†Ô∏è –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ `kubernetes/api.yml`.
–ó–∞–º–µ–Ω–∏—Ç–µ `namespace` –∏ –≤ Deployment –≤ Service —Ç–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º.
```yaml
...
  namespace: {{NAMESPACE}}
...
```
–ü–æ—Å—Ç—É–ø–∏–º —Å `image` –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ, –º—ã –±—É–¥–µ–º –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å —Ç–æ—á–Ω—ã–µ –≤–µ—Ä—Å–∏–∏ –æ–±—Ä–∞–∑–∞ Docker –¥–ª—è —Ç–æ–≥–æ —á—Ç–æ–±—ã –¥–∞—Ç—å Kubernetes –∑–Ω–∞—Ç—å —á—Ç–æ Pod —Å–ª–µ–¥—É–µ—Ç –æ–±–Ω–æ–≤–∏—Ç—å.
```yaml
...
        image: {{API_IMAGE}}
...
```

–ú—ã —Ç–µ–ø–µ—Ä—å –º–æ–∂–µ–º –ø–æ–¥—Å—Ç–∞–≤–∏—Ç—å –¥—Ä—É–≥–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –æ–±—Ä–∞–∑–∞, –Ω–æ –Ω–∞—à –ª–æ–∫–∞–ª—å–Ω—ã–π –æ–±—Ä–∞–∑ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –Ω–µ –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø –¥–ª—è GKE. –ù–∞–º –Ω—É–∂–Ω–æ —Ä–∞–∑–º–µ—Å—Ç–∏—Ç—å –Ω–∞—à –æ–±—Ä–∞–∑ –≤ —Å–µ—Ä–≤–∏—Å–µ –¥–æ—Å—Ç—É–ø–Ω–æ–º –¥–ª—è Kubernetes. –ó–∞–≥—Ä—É–∑–∏–º –ª–æ–∫–∞–ª—å–Ω—ã–π –æ–±—Ä–∞–∑ –≤ GitLab Repository.

üõ†Ô∏è –í **–ª–æ–∫–∞–ª—å–Ω–æ–π** –∫–æ–Ω—Å–æ–ª–∏ –Ω–∞–±–µ—Ä–∏—Ç–µ
```bash
docker login registry.gitlab.com/$GITLAB_USER_NAME/gitlab-kubernetes
```
–∏ –≤–≤–µ–¥–∏—Ç–µ —Å–≤–æ–∏ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –≤—Ö–æ–¥–∞ –≤ GitLab.

üõ†Ô∏è –ü—Ä–∏—Å–≤–æ–π—Ç–µ –æ–±—Ä–∞–∑—É —Ç—ç–≥ —Å –ø—Ä–µ—Ñ–∏–∫—Å–æ–º –Ω–∞—à–µ–≥–æ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è –≤ GitLab.
```bash
docker tag gitlab-course-api registry.gitlab.com/$GITLAB_USER_NAME/gitlab-kubernetes/api
```

üõ†Ô∏è –¢–µ–ø–µ—Ä—å –º—ã –º–æ–∂–µ–º –∑–∞–≥—Ä—É–∑–∏—Ç—å –Ω–∞—à –æ–±—Ä–∞–∑ –≤ —É–¥–∞–ª—ë–Ω–Ω—ã–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π. –í—ã–ø–æ–ª–Ω–∏—Ç–µ –∫–æ–º–∞–Ω–¥—É
```bash
docker push registry.gitlab.com/$GITLAB_USER_NAME/gitlab-kubernetes/api
```
–î–æ–∂–¥–∏—Ç–µ—Å—å –æ–∫–æ–Ω—á–∞–Ω–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ –∏ —É–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –æ–Ω–∞ –ø—Ä–æ—à–ª–∞ —É—Å–ø–µ—à–Ω–æ.


üõ†Ô∏è –í **Google Cloud Shell** –Ω–∞–±–µ—Ä–∏—Ç–µ
```bash
docker login registry.gitlab.com/$GITLAB_USER_NAME/gitlab-kubernetes
```

üõ†Ô∏è –ï—Å—Ç—å –Ω—é–∞–Ω—Å, –∑–∞–∫–ª—é—á–∞—é—â–∏–π—Å—è –≤ —Ç–æ–º, —á—Ç–æ –¥–ª—è —Ç–æ–≥–æ —á—Ç–æ–±—ã —Å–∫–∞—á–∞—Ç—å –æ–±—Ä–∞–∑ –∏–∑ –Ω–∞—à–µ–≥–æ –ø—Ä–∏–≤–∞—Ç–Ω–æ–≥–æ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è –Ω–∞ GitLab.com –Ω—É–∂–Ω–æ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–∏—Ç—å –Ω–µ–∫–æ—Ç–æ—Ä—ã–π —Å–µ–∫—Ä–µ—Ç. –î–ª—è —ç—Ç–æ–≥–æ –º—ã –º–æ–∂–µ–º –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å–µ–∫—Ä–µ—Ç, –∫–æ—Ç–æ—Ä—ã–π –±—ã–ª —Å–æ–∑–¥–∞–Ω –ø–æ –ø—É—Ç–∏ `~/.docker/config.json` –∫–æ–≥–¥–∞ –º—ã –≤—ã–ø–æ–ª–Ω–∏–ª–∏ –∫–æ–º–∞–Ω–¥—É `docker login`. –í—ã–ø–æ–ª–Ω–∏—Ç–µ —ç—Ç—É –∫–æ–º–∞–Ω–¥—É –≤ **Google Cloud Shell**.
```bash
kubectl create secret generic regcred \
    --from-file=.dockerconfigjson=$HOME/.docker/config.json \
    --type=kubernetes.io/dockerconfigjson \
    --namespace=gitlab-course
```
–ü–æ—Å–ª–µ–¥–Ω—è—è —á–∞—Å—Ç—å –≥–æ–ª–æ–≤–æ–ª–æ–º–∫–∏ —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–æ–π –æ–±—Ä–∞–∑–∞ - –¥–æ–±–∞–≤–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –Ω–∞—à–µ–º —Å–µ–∫—Ä–µ—Ç–µ –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—é –≤ `kubernetes/api.yml`. –†–∞–∑–º–µ—Å—Ç–∏—Ç–µ —ç—Ç–æ—Ç –∫–æ–¥ –≤ –∫–æ–Ω—Ü–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è Deployment —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ `volumes:` –Ω–∞ –æ–¥–Ω–æ–º —É—Ä–æ–≤–Ω–µ —Å `containers:`
```yaml
...
      imagePullSecrets:
      - name: regcred
...
```

–í Google Cloud –º—ã –±—É–¥–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Ingress –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ —Ç—Ä–∞—Ñ—Ñ–∏–∫–∞ —Å –≤–Ω–µ—à–Ω–µ–≥–æ IP –Ω–∞ Pod –≤ Kubernetes. –≠—Ç–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è Ingress "–ø–æ–¥ –∫–∞–ø–æ—Ç–æ–º" –∏—Å–ø–æ–ª—å–∑—É–µ—Ç External HTTP/S Load Balancer –∏ —Ç—Ä–µ–±—É–µ—Ç —á—Ç–æ–±—ã –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã –±—ã–ª–∏ –¥–æ—Å—Ç—É–ø–Ω—ã –∫–∞–∫ `NodePort`.
–ò–∑–º–µ–Ω–∏–º —Ç–∏–ø —Å–µ—Ä–≤–∏—Å–∞ –≤ `kubernetes/api.yml`.
```yaml
...
spec:
  type: NodePort
...
```

–í –∏—Ç–æ–≥–µ –≤–Ω—É—Ç—Ä–∏ `kubernetes/api.yml` –¥–æ–ª–∂–µ–Ω –ø–æ–ª—É—á–∏—Ç—å—Å—è —Ç–∞–∫–æ–π –∫–æ–¥:
```yaml
kind: Deployment
apiVersion: apps/v1
metadata:
  name: gitlab-course-api
  namespace: {{NAMESPACE}}
  labels:
    k8s-app: gitlab-course-api
    project: gitlab-course
spec:
  replicas: 1
  selector:
    matchLabels:
      k8s-app: gitlab-course-api
  template:
    metadata:
      name: gitlab-course-api
      labels:
        k8s-app: gitlab-course-api
    spec:
      containers:
      - name: gitlab-course-api
        image: {{API_IMAGE}}
        imagePullPolicy: IfNotPresent
        volumeMounts:
        - name: gitlab-course-pv
          mountPath: /app/data
      volumes:
      - name: gitlab-course-pv
        persistentVolumeClaim:
          claimName: gitlab-course-pv-claim
      imagePullSecrets:
      - name: regcred
---
kind: Service
apiVersion: v1
metadata:
  name: gitlab-course-api
  namespace: {{NAMESPACE}}
  labels:
    k8s-app: gitlab-course-api
    project: gitlab-course
spec:
  type: NodePort
  ports:
  - protocol: TCP
    port: 80
    targetPort: 4000
  selector:
    k8s-app: gitlab-course-api
```

–û—Ç–ª–∏—á–Ω–æ! –¢–µ–ø–µ—Ä—å –Ω–∞—à –æ–±—Ä–∞–∑ –¥–æ—Å—Ç—É–ø–µ–Ω –¥–ª—è Kubernetes –∏ –º—ã –º–æ–∂–µ–º —Å–æ–∑–¥–∞—Ç—å Pod!

üõ†Ô∏è –ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–∞–π–ª `kubernetes/api.yml` –≤ Google Cloud Console –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –∫–æ–º–∞–Ω–¥—É.
```bash
sed -e 's/{{NAMESPACE}}/gitlab-course/g' -e "s~{{API_IMAGE}}~registry.gitlab.com/$GITLAB_USER_NAME/gitlab-kubernetes/api~g" api.yml | kubectl apply -f -
```

–£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ —Ä–µ—Å—É—Ä—Å—ã —Å–æ–∑–¥–∞–Ω—ã —É—Å–ø–µ—à–Ω–æ.

üí° –û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ —á—Ç–æ –º—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º `~` –≤ –∫–∞—á–µ—Å—Ç–≤–µ —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—è –≤–æ –≤—Ç–æ—Ä–æ–º –≤—ã—Ä–∞–∂–µ–Ω–∏–∏ `sed` –ø–æ—Ç–æ–º—É —á—Ç–æ –≤ –∏–º–µ–Ω–∏ –æ–±—Ä–∞–∑–∞ —É–∂–µ –≤—Å—Ç—Ä–µ—á–∞–µ—Ç—Å—è `/`.

üí° –ï—Å–ª–∏ –≤—ã –∑–∞—Ö–æ—Ç–∏—Ç–µ –æ–±–Ω–æ–≤–∏—Ç—å –æ–±—Ä–∞–∑ Pod –≤ Kubernetes, –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è —ç—Ç–æ—Ç Pod –ø–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å. –î–ª—è **API** —ç—Ç–æ –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å, –Ω–∞–ø—Ä–∏–º–µ—Ä, —ç—Ç–æ–π –∫–æ–º–∞–Ω–¥–æ–π.
```bash
kubectl rollout restart deployment gitlab-course-api -n gitlab-course
```
–ó–∞—Ç–µ–º –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è –≤—ã–ø–æ–ª–Ω–∏—Ç—å `kubectl apply` –µ—â—ë —Ä–∞–∑, —É–∫–∞–∑–∞–≤ sha256 —è–≤–Ω–æ, –¥–æ–±–∞–≤–∏–≤ –∫ –∏–º–µ–Ω–∏ –æ–±—Ä–∞–∑–∞ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏—é `@sha256:<hash>`.

#### –†–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏–µ Ingress

üí° –ú—ã –≤–æ—Å–ø–æ–ª—å–∑—É–µ–º—Å—è [nip.io](https://nip.io/) –¥–ª—è —Ç–æ–≥–æ —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –¥–æ–º–µ–Ω. –ü—Ä–æ–±–ª–µ–º–∞ —Ç—É—Ç –≤ —Ç–æ–º, —á—Ç–æ –¥–ª—è —Ç–æ–≥–æ —á—Ç–æ–±—ã —É–∫–∞–∑–∞—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ö–æ—Å—Ç –¥–ª—è **API** –≤ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–∏ Ingress, –Ω–∞–º –Ω—É–∂–Ω–æ –∑–Ω–∞—Ç—å –≤–Ω–µ—à–Ω–∏–π IP –∞–¥—Ä–µ—Å Ingress. –û–¥–Ω–∞–∫–æ IP –∞–¥—Ä–µ—Å –±—É–¥–µ—Ç –ø—Ä–∏—Å–≤–æ–µ–Ω Ingress —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ —Ç–æ–≥–æ –∫–∞–∫ –º—ã —Å–æ–∑–¥–∞–¥–∏–º Ingress. –†–µ—à–µ–Ω–∏–µ –≤ —Ç–æ–º —á—Ç–æ–±—ã –≤–Ω–∞—á–∞–ª–µ —Å–æ–∑–¥–∞—Ç—å, –∞ –∑–∞—Ç–µ–º –∏–∑–º–µ–Ω–∏—Ç—å Ingress. 

üõ†Ô∏è –°–æ–∑–¥–∞–¥–∏–º Ingress. –ò–∑–º–µ–Ω–∏—Ç–µ —Ñ–∞–π–ª `kubernetes/ingress.yml`.

```yaml
kind: Ingress
apiVersion: networking.k8s.io/v1
metadata:
  name: gitlab-course-ingress
  namespace: {{NAMESPACE}}
  labels:
    project: gitlab-course
spec:
  defaultBackend:
    service:
      name: gitlab-course-api
      port:
        number: 80
```

üí° –ß—Ç–æ–±—ã —Å–æ–∑–¥–∞—Ç—å Ingress –Ω–∞–º –Ω—É–∂–Ω–æ —É–∫–∞–∑–∞—Ç—å –∏–ª–∏ —Ö–æ—Ç—è –±—ã –æ–¥–Ω–æ –ø—Ä–∞–≤–∏–ª–æ –ª–∏–±–æ –±—ç–∫–µ–Ω–¥ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é. –ú—ã –≤—Ä–µ–º–µ–Ω–Ω–æ —É–∫–∞–∑—ã–≤–∞–µ–º —Å–µ—Ä–≤–∏—Å **API** –ø–æ—Ç–æ–º—É —á—Ç–æ –æ–Ω —É–∂–µ —Å–æ–∑–¥–∞–Ω.

üõ†Ô∏è –ó–∞–≥—Ä—É–∑–∏—Ç–µ —ç—Ç–æ—Ç —Ñ–∞–π–ª –≤ Google Cloud Shell.
```bash
sed "s/{{NAMESPACE}}/gitlab-course/g" ingress.yml | kubectl apply -f -
```

üõ†Ô∏è –î–∞–≤–∞–π—Ç–µ –¥–æ–∂–¥—ë–º—Å—è –ø—Ä–∏—Å–≤–∞–∏–≤–∞–Ω–∏—è –≤–Ω–µ—à–Ω–µ–≥–æ IP –Ω–∞—à–µ–º—É Ingress. –≠—Ç–æ —É–¥–æ–±–Ω–æ —Å–¥–µ–ª–∞—Ç—å –≤—ã–ø–æ–ª–Ω–∏—Ç–µ —ç—Ç—É –∫–æ–º–∞–Ω–¥—É
```bash
kubectl get ingress --all-namespaces --watch
```
–ü—Ä–µ–∫—Ä–∞—Ç–∏—Ç–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥—ã –ø—Ä–∏ –ø–æ–º–æ—â–∏ `Ctrl + C` –∫–æ–≥–¥–∞ –≤–Ω–µ—à–Ω–∏–π IP –±—É–¥–µ—Ç –ø—Ä–∏—Å–≤–æ–µ–Ω. –ü—Ä–∏—Å–≤–æ–π—Ç–µ –µ–≥–æ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π `EXTERNAL_IP`
```bash
EXTERNAL_IP=<–≤–Ω–µ—à–Ω–∏–π IP –ø–æ–ª—É—á–µ–Ω–Ω—ã–π –ø—Ä–µ–¥—ã–¥—É—â–µ–π –∫–æ–º–∞–Ω–¥–æ–π>
```
–î–ª—è –ø—Ä–æ—Å—Ç–æ—Ç—ã —è –±—É–¥—É –Ω–∞–∑—ã–≤–∞—Ç—å —Å–∞–º –∞–¥—Ä–µ—Å —Ç–æ–∂–µ `EXTERNAL_IP`. 

üõ†Ô∏è –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ –ø–æ –∞–¥—Ä–µ—Å—É `http://EXTERNAL_IP.nip.io`. –ù–∞–ø—Ä–∏–º–µ—Ä, –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —ç—Ç–æ–≥–æ –∫—É—Ä—Å–∞, –∞–¥—Ä–µ—Å –¥–ª—è –º–µ–Ω—è –≤—ã–≥–ª—è–¥–µ–ª `http://34.102.175.33.nip.io/log`

–£–±–µ–¥–∏—Ç–µ—Å—å, –ø–æ–ª—É—á–µ–Ω –æ—Ç–≤–µ—Ç —Å –∫–æ–¥–æ–º `200 OK`.

–ò—Ç–∞–∫, –º—ã –ø–æ—á—Ç–∏ –∑–∞–∫–æ–Ω—á–∏–ª–∏ —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞—Ç—å –Ω–∞—à–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤ GKE, –æ—Å—Ç–∞–ª–æ—Å—å —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—å **SPA** –∏ –æ–±–Ω–æ–≤–∏—Ç—å Ingress.

#### –†–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏–µ SPA

üõ†Ô∏è –ü–æ–º–Ω–∏—Ç–µ –ø—Ä–æ –Ω—é–∞–Ω—Å —Å **SPA**? –í–Ω—É—Ç—Ä–∏ –æ–±—Ä–∞–∑–∞ –≤—Å—Ç—Ä–æ–µ–Ω –∞–¥—Ä–µ—Å **API**, –∑–∞–¥–∞–Ω–Ω—ã–π —á–µ—Ä–µ–∑ `API_URL`. –•–æ—Ä–æ—à–∏–µ –Ω–æ–≤–æ—Å—Ç–∏ –≤ —Ç–æ–º —á—Ç–æ –º—ã —É–∂–µ —Å–æ–∑–¥–∞–ª–∏ Ingress –∏ –ø–æ—ç—Ç–æ–º—É –∑–Ω–∞–µ–º –∞–¥—Ä–µ—Å, –∫–æ—Ç–æ—Ä—ã–π –º–æ–∂–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ –∫–∞—á–µ—Å—Ç–≤–µ `API_URL`. –ü–µ—Ä–µ—Å–æ–±–µ—Ä—ë–º –æ–±—Ä–∞–∑ **SPA** —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —ç—Ç–æ–≥–æ –∞–¥—Ä–µ—Å–∞. –í—ã–ø–æ–ª–Ω–∏—Ç–µ —ç—Ç—É –∫–æ–º–∞–Ω–¥—É –≤ –ª–æ–∫–∞–ª—å–Ω–æ–π –∫–æ–Ω—Å–æ–ª–∏.
```bash
docker build ./spa --build-arg API_URL="http://$EXTERNAL_IP.nip.io" -t registry.gitlab.com/$GITLAB_USER_NAME/gitlab-kubernetes/spa
docker push registry.gitlab.com/$GITLAB_USER_NAME/gitlab-kubernetes/spa
```

üõ†Ô∏è –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ `kubernetes/spa.yml`. –≠—Ç–æ –±—É–¥—É—Ç —Ç–µ –∂–µ –ø—Ä–∞–≤–∫–∏ —á—Ç–æ –∏ –≤ `kubernetes/api.yml` –¥–æ —Ç–æ–≥–æ. 

–ó–∞–º–µ–Ω–∏—Ç–µ `namespace` –∏ –≤ Deployment –∏ –≤ Service —Ç–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º.
```yaml
...
  namespace: {{NAMESPACE}}
...
```

–ü–æ—Å—Ç—É–ø–∏–º —Å `image` –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ.
```yaml
...
        image: {{SPA_IMAGE}}
...
```

–ò–∑–º–µ–Ω–∏–º —Ç–∏–ø —Å–µ—Ä–≤–∏—Å–∞ –≤ `kubernetes/spa.yml` –Ω–∞ `NodePort`.
```yaml
...
spec:
  type: NodePort
...
```

–†–∞–∑–º–µ—Å—Ç–∏—Ç–µ —Å–µ–∫—Ä–µ—Ç –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π GitLab –≤ –∫–æ–Ω—Ü–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è Deployment –Ω–∞ –æ–¥–Ω–æ–º —É—Ä–æ–≤–Ω–µ —Å `containers:`
```yaml
...
      imagePullSecrets:
      - name: regcred
...
```

–í –∏—Ç–æ–≥–µ –¥–æ–ª–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å—Å—è —Ç–∞–∫–æ–µ:
```yaml
kind: Deployment
apiVersion: apps/v1
metadata:
  name: gitlab-course-spa
  namespace: {{NAMESPACE}}
  labels:
    k8s-app: gitlab-course-spa
    project: gitlab-course
spec:
  replicas: 1
  selector:
    matchLabels:
      k8s-app: gitlab-course-spa
  template:
    metadata:
      name: gitlab-course-spa
      labels:
        k8s-app: gitlab-course-spa
    spec:
      containers:
      - name: gitlab-course-spa
        image: {{SPA_IMAGE}}
        imagePullPolicy: IfNotPresent
      imagePullSecrets:
      - name: regcred
---
kind: Service
apiVersion: v1
metadata:
  name: gitlab-course-spa
  namespace: {{NAMESPACE}}
  labels:
    k8s-app: gitlab-course-spa
    project: gitlab-course
spec:
  type: NodePort
  ports:
  - protocol: TCP
    port: 80
    targetPort: 80
  selector:
    k8s-app: gitlab-course-spa
```

üõ†Ô∏è –ó–∞–≥—Ä—É–∑–∏—Ç–µ `kubernetes/spa.yml` –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é `~/gitlab-course` Cloud Shell –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –∫–æ–º–∞–Ω–¥—É.
```bash
sed -e 's/{{NAMESPACE}}/gitlab-course/g' -e "s~{{SPA_IMAGE}}~registry.gitlab.com/$GITLAB_USER_NAME/gitlab-kubernetes/spa~g" spa.yml | kubectl apply -f -
```

üõ†Ô∏è –û—Å—Ç–∞–ª–æ—Å—å –æ–±–Ω–æ–≤–∏—Ç—å Ingress - –∏ –º—ã –∑–∞–∫–æ–Ω—á–∏–ª–∏. –î–∞–≤–∞–π—Ç–µ —Å–¥–µ–ª–∞–µ–º —ç—Ç–æ —Å–µ–π—á–∞—Å. –£–∫–∞–∂–µ–º **SPA** –≤ –∫–∞—á–µ—Å—Ç–≤–µ —Å–µ—Ä–≤–∏—Å–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –∏ –±—É–¥–µ–º –Ω–∞–ø—Ä–∞–≤–ª—è—Ç—å –∑–∞–ø—Ä–æ—Å—ã –∫ **API** –µ—Å–ª–∏ –ø—É—Ç—å —Ä–∞–≤–µ–Ω `/log`. –û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ —á—Ç–æ –º—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º Ingress –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤ GKE, –∏ –ø–æ—Ç–æ–º—É —É–∫–∞–∑—ã–≤–∞–µ–º `pathType: ImplementationSpecific`. 
```yaml
kind: Ingress
apiVersion: networking.k8s.io/v1
metadata:
  name: gitlab-course-ingress
  namespace: {{NAMESPACE}}
  labels:
    project: gitlab-course
spec:
  rules:
    - host: {{EXTERNAL_IP}}.nip.io
      http:
        paths:
          - path: /log
            pathType: ImplementationSpecific
            backend:
              service:
                name: gitlab-course-api
                port:
                  number: 80
  defaultBackend:
    service:
      name: gitlab-course-spa
      port:
        number: 80
```

üõ†Ô∏è –£–¥–∞–ª–∏—Ç–µ —Ñ–∞–π–ª `ingress.yml` –≤ Google Cloud Shell, –∞ –∑–∞—Ç–µ–º –∑–∞–Ω–æ–≤–æ –∑–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–∞–π–ª `kubernetes/ingress.yml` –≤ Google Cloud Shell –∏ –ø—Ä–∏–º–µ–Ω–∏—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ–º–∞–Ω–¥–æ–π.
```bash
sed -e 's/{{NAMESPACE}}/gitlab-course/g' -e "s/{{EXTERNAL_IP}}/$EXTERNAL_IP/g" ingress.yml | kubectl apply -f -
```

üõ†Ô∏è –ó–∞–π–¥–∏—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É `EXTERNAL_IP.nip.io` –∏ —É–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –Ω–∞—à–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ –ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ—Ç—Å—è. –í–∞–º –º–æ–∂–µ—Ç –ø–æ–Ω–∞–¥–æ–±–∏—Ç—å—Å—è –ø–æ–¥–æ–∂–¥–∞—Ç—å –Ω–µ–∫–æ—Ç–æ—Ä–æ–µ –≤—Ä–µ–º—è –ø–æ–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Ingress –æ–±–Ω–æ–≤–∏—Ç—Å—è –≤ GCP. 

üëç –ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º, –≤—ã —Ä–∞–∑–≤–µ—Ä–Ω—É–ª–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤ Kubernetes –≤ Google Cloud Platform! –û—Å—Ç–∞–ª–æ—Å—å —Ç–æ–ª—å–∫–æ –æ—Ä–≥–∞–Ω–∏–∑–æ–≤–∞—Ç—å —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ GitLab.

## ü¶ä –†–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏–µ –≤ Kubernetes –ø—Ä–∏ –ø–æ–º–æ—â–∏ GitLab 

![–†–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏–µ –≤ Kubernetes –ø—Ä–∏ –ø–æ–º–æ—â–∏ GitLab](img/gitlab_gke_800.png)

–°–∞–º–æ–µ —Å–ª–æ–∂–Ω–æ–µ –ø–æ–∑–∞–¥–∏, –æ—Å—Ç–∞–ª–æ—Å—å —Ä–∞–∑—Ä–∞–±–æ—Ç–∞—Ç—å pipeline –≤ GitLab. –ò—Ç–∞–∫, –Ω–∞—á–Ω—ë–º.

üí° –ú—ã –Ω–µ –±—É–¥–µ–º –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –∑–¥–µ—Å—å –∫–∞–∫ –æ–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø—Ä–∏ –ø–æ–º–æ—â–∏ AutoDevOps (–∫—Ä–∞—Å–∏–≤–æ–µ!) –ø–æ—Ç–æ–º—É —á—Ç–æ AutoDevOps –∏ –≤—Å—ë —á—Ç–æ —Å –Ω–∏–º —Å–≤—è–∑–∞–Ω–æ –º–µ–Ω—è–µ—Ç—Å—è –∫—Ä–∞–π–Ω–µ —á–∞—Å—Ç–æ, –∏, –∫—Ä–æ–º–µ —Ç–æ–≥–æ –º–∞–ª–æ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è —á–µ–≥–æ-–ª–∏–±–æ —Å–ª–æ–∂–Ω–µ–µ `Hello World!`. –¢–µ–º –Ω–µ –º–µ–Ω–µ–µ, —è —Ä–µ–∫–æ–º–µ–Ω–¥—É—é –ø—Ä–æ–π—Ç–∏ [–æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π —Ç—É—Ç–æ—Ä–∏–∞–ª](https://docs.gitlab.com/ee/topics/autodevops/quick_start_guide.html) —á—Ç–æ–±—ã —Å–æ—Å—Ç–∞–≤–∏—Ç—å –≤–ø–µ—á–∞—Ç–ª–µ–Ω–∏–µ –æ –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã—Ö –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—è—Ö GitLab –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏—Ö –ø–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –≤ –¥–∞–ª—å–Ω–µ–π—à–µ–º.

üí° –Ø –Ω–µ –¥—É–º–∞—é —á—Ç–æ —Ä–µ–∞–ª—å–Ω–æ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–∏—Ç—å —Ä–µ—à–µ–Ω–∏–µ –≤ —Å—Ç–∏–ª–µ "–æ–¥–∏–Ω —Ä–∞–∑–º–µ—Ä –ø–æ–¥—Ö–æ–¥–∏—Ç –≤—Å–µ–º" —Ç–∞–∫ –∫–∞–∫ —á–µ–º "–ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–µ–µ" –∫–æ–Ω–≤–µ–π–µ—Ä —Ç–µ–º –æ–Ω —Å–ª–æ–∂–Ω–µ–µ –∏ —Ç–µ–º —Å–∏–ª—å–Ω–µ–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã –Ω–∞ –∫–æ—Ç–æ—Ä–æ–π –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏–µ. –ü–æ —ç—Ç–æ–π –ø—Ä–∏—á–∏–Ω–µ –º—ã –Ω–µ –±—É–¥–µ–º —Å—Ç—Ä–µ–º–∏—Ç—å—Å—è —Å–æ–∑–¥–∞—Ç—å –≤—ã—Å–æ–∫–æ–æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–æ–Ω–≤–µ–π–µ—Ä, –∞ –≤–º–µ—Å—Ç–æ —ç—Ç–æ–≥–æ —Å–æ—Å—Ä–µ–¥–æ—Ç–æ—á–∏–º—Å—è –Ω–∞ —Å–æ–∑–¥–∞–Ω–∏–∏ —Ä–µ—à–µ–Ω–∏—è –∫–æ—Ç–æ—Ä–æ–µ –ø—Ä–æ—Å—Ç–æ –ø–æ–Ω—è—Ç—å –∏ –∫–æ—Ç–æ—Ä–æ–µ –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç —Ä–∞–∑–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏.

üì¢ –ü–ª–∞–Ω —Ç–∞–∫–æ–π
- –£–¥–∞–ª–∏–º —Ä–µ—Å—É—Ä—Å—ã, —Å–æ–∑–¥–∞–Ω–Ω—ã–µ –Ω–∞ –ø—Ä–µ–¥—ã–¥—É—â–µ–º —ç—Ç–∞–ø–µ
- –ó–∞–¥–∞–¥–∏–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
- –†–µ–∞–ª–∏–∑—É–µ–º —Å–±–æ—Ä–∫—É –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- –†–µ–∞–ª–∏–∑—É–µ–º —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏–µ –≤ GKE

### –£–¥–∞–ª–∏–º —Ä–µ—Å—É—Ä—Å—ã, —Å–æ–∑–¥–∞–Ω–Ω—ã–µ –Ω–∞ –ø—Ä–µ–¥—ã–¥—É—â–µ–º —ç—Ç–∞–ø–µ

üõ†Ô∏è –ë—É–¥–µ–º —É–¥–∞–ª—è—Ç—å —Ä–µ—Å—É—Ä—Å—ã "—Å–≤–µ—Ä—Ö—É –≤–Ω–∏–∑". –í—ã–ø–æ–ª–Ω–∏—Ç–µ —ç—Ç–∏ –∫–æ–º–∞–Ω–¥—ã –≤ Google Cloud Shell.
```yaml
kubectl delete ingress gitlab-course-ingress -n gitlab-course
kubectl delete service gitlab-course-api -n gitlab-course
kubectl delete service gitlab-course-spa -n gitlab-course
kubectl delete deployment gitlab-course-api -n gitlab-course
kubectl delete deployment gitlab-course-spa -n gitlab-course
kubectl delete pvc gitlab-course-pv-claim -n gitlab-course
kubectl delete secret regcred -n gitlab-course
```

### –ó–∞–¥–∞—ë–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

üõ†Ô∏è –ò—Ç–∞–∫, –Ω–∞—à –∫–æ–Ω–≤–µ–π–µ—Ä –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é `EXTERNAL_IP`, –∫–æ—Ç–æ—Ä–∞—è –±—É–¥–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å –≤–Ω–µ—à–Ω–∏–π IP –Ω–∞—à–µ–≥–æ Ingress. 
–î–∞–≤–∞–π—Ç–µ –∑–∞–¥–∞–¥–∏–º –µ—ë –∑–Ω–∞—á–µ–Ω–∏–µ –≤–Ω—É—Ç—Ä–∏ GitLab. 

- –û—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É –Ω–∞—à–µ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞ –≤ GitLab `gitlab-kubernetes`
- –í –ª–µ–≤–æ–º –º–µ–Ω—é –≤ –ø–æ–¥–º–µ–Ω—é **Settings** –≤—ã–±–µ—Ä–∏—Ç–µ **CI/CD**. 
- –†–∞—Å–∫—Ä–æ–π—Ç–µ –ø–æ–¥–º–µ–Ω—é **Variables**.
- –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É **Add Variable**, –≤ –ø–æ–ª–µ **Key** –≤–≤–µ–¥–∏—Ç–µ `EXTERNAL_IP`, –≤ –ø–æ–ª–µ **Value** –≤–≤–µ–¥–∏—Ç–µ –∑–Ω–∞—á–µ–Ω–∏–µ, –ø–æ–ª—É—á–µ–Ω–Ω–æ–µ –≤–∞–º–∏ –Ω–∞ –ø—Ä–µ–¥—ã–¥—É—â–µ–º —ç—Ç–∞–ø–µ. –ù–∞ —Å–∞–º–æ–º –¥–µ–ª–µ –Ω–µ—Ç –≥–∞—Ä–∞–Ω—Ç–∏–∏ —á—Ç–æ GCP –ø—Ä–∏—Å–≤–æ–∏—Ç –≤–Ω–æ–≤—å —Å–æ–∑–¥–∞–Ω–Ω–æ–º—É Ingress —Ç–æ—Ç –∂–µ IP, —á—Ç–æ –∏ –Ω–µ–¥–∞–≤–Ω–æ —É–¥–∞–ª—ë–Ω–Ω–æ–º—É, –Ω–æ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å —ç—Ç–æ–≥–æ –≤—ã—Å–æ–∫–∞, –∞ –µ—Å–ª–∏ —ç—Ç–æ–≥–æ –Ω–µ –ø—Ä–æ–∏–∑–æ–π–¥—ë–º, –º—ã —Å–º–æ–∂–µ–º –ª–µ–≥–∫–æ —ç—Ç–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å.
- –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É **Add Variable** –≤–Ω–∏–∑—É —Ñ–æ—Ä–º—ã. 

–ì–æ—Ç–æ–≤–æ!

–ï—Å–ª–∏ –≤—ã –æ—Ç–ª–∞–∂–∏–≤–∞–µ—Ç–µ –≤–∞—à –∫–æ–Ω–≤–µ–π–µ—Ä, –≤—ã —Ç–∞–∫–∂–µ –º–æ–∂–µ—Ç–µ –∑–∞—Ö–æ—Ç–µ—Ç—å –¥–æ–±–∞–≤–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é `CI_DEBUG_TRACE` —Å–æ –∑–Ω–∞—á–µ–Ω–∏–µ–º `true`. –ï—Å–ª–∏ –≤—ã —ç—Ç–æ —Å–¥–µ–ª–∞–µ—Ç–µ, –≤ –ª–æ–≥–µ job –±—É–¥—É—Ç –æ—Ç–æ–±—Ä–∞–∂–µ–Ω—ã –∑–Ω–∞—á–µ–Ω–∏—è –≤—Å–µ—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤.

üí° –í—Å–µ–≥–¥–∞ –≤–∫–ª—é—á–µ–Ω–Ω—ã–π `CI_DEBUG_TRACE` —Å–æ–∑–¥–∞—ë—Ç —Ä–∏—Å–∫–∏ –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏.

### –†–µ–∞–ª–∏–∑—É–µ–º —Å–±–æ—Ä–∫—É –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

üõ†Ô∏è –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.gitlab-ci.yml` –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞. –î–æ–±–∞–≤—å—Ç–µ —ç—Ç–æ—Ç –∫–æ–¥
```yaml
image: docker:stable
services:
# we will build our images by running docker daemon inside a container
- docker:dind
variables:
  DOCKER_DRIVER: overlay2
  SPA_DOCKER_IMAGE: $CI_REGISTRY_IMAGE/spa
  SPA_DOCKER_BUILDER_IMAGE: $CI_REGISTRY_IMAGE/spa-build
  API_DOCKER_IMAGE: $CI_REGISTRY_IMAGE/api
```
`DOCKER_DRIVER: overlay2` - –°–æ–≥–ª–∞—Å–Ω–æ [–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏](https://docs.gitlab.com/ee/ci/docker/using_docker_build.html), `overlay2` —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–µ–µ `vfs`. –ù–∞ —Å–∞–º–æ–º –¥–µ–ª–µ —ç—Ç–æ –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è shared runners, –Ω–æ –º—ã –æ—Å—Ç–∞–≤–∏–ª–∏ —ç—Ç—É —Å—Ç—Ä–æ—á–∫—É –Ω–∞ —Å–ª—É—á–∞–π –µ—Å–ª–∏ –≤—ã –∑–∞—Ö–æ—Ç–∏—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å self-hosted runners.

```yaml
  SPA_DOCKER_IMAGE: $CI_REGISTRY_IMAGE/spa
  SPA_DOCKER_BUILDER_IMAGE: $CI_REGISTRY_IMAGE/spa-build
  API_DOCKER_IMAGE: $CI_REGISTRY_IMAGE/api
```
–≠—Ç–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –º—ã –∑–∞–≤–µ–ª–∏ –¥–ª—è –Ω–∞—à–µ–≥–æ —É–¥–æ–±—Å—Ç–≤–∞. –≠—Ç–æ –Ω–∞–∑–≤–∞–Ω–∏—è –Ω–∞—à–∏—Ö –æ–±—Ä–∞–∑–æ–≤ –≤–Ω—É—Ç—Ä–∏ GitLab registry. –ü–æ—á–µ–º—É —É –Ω–∞—Å —Ç–æ–ª—å–∫–æ –æ–¥–Ω–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –¥–ª—è **API**, –Ω–æ –¥–≤–µ –¥–ª—è **SPA**?  

–î–ª—è **API** –º—ã –ø—Ä–æ—Å—Ç–æ —É–ø–∞–∫–æ–≤—ã–≤–∞–µ–º `server.js` –≤–Ω—É—Ç—Ä—å –Ω–µ–±–æ–ª—å—à–æ–≥–æ –æ–±—Ä–∞–∑–∞ —Å Node.js. 

–î–ª—è **SPA**, –∫–∞–∫ –≤—ã –ø–æ–º–Ω–∏—Ç–µ, –º—ã –¥–µ–ª–∞–ª–∏ –¥–≤—É—Ö—ç—Ç–∞–ø–Ω—É—é —Å–±–æ—Ä–∫—É. 
- –° –æ–¥–Ω–æ–π —Å—Ç–æ—Ä–æ–Ω—ã, –º—ã —Ö–æ—Ç–∏–º —á—Ç–æ–±—ã –æ–±—Ä–∞–∑ –≤ –ø—Ä–æ–¥–∞–∫—à–Ω–µ –±—ã–ª –∫–∞–∫ –º–æ–∂–Ω–æ –º–µ–Ω—å—à–µ. 
- –° –¥—Ä—É–≥–æ–π —Å—Ç–æ—Ä–æ–Ω—ã, –≤ –Ω–∞—à–µ–º CD-–∫–æ–Ω–≤–µ–π–µ—Ä–µ –º—ã –±—É–¥–µ–º –∑–∞–ø—É—Å–∫–∞—Ç—å –∞–≤—Ç–æ—Ç–µ—Å—Ç—ã, –∞ –¥–ª—è —ç—Ç–æ–≥–æ –Ω—É–∂–Ω—ã —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –º–æ–¥—É–ª–∏ NPM, —Ç.–µ. –¥–ª—è —ç—Ç–æ–≥–æ –Ω–∞–º –Ω—É–∂–µ–Ω "–±–æ–ª—å—à–æ–π" –æ–±—Ä–∞–∑. 

–†–µ—à–µ–Ω–∏–µ –≤ —Ç–æ–º —á—Ç–æ–±—ã —Ä–∞–∑–¥–µ–ª–∏—Ç—å –Ω–∞—à—É –¥–≤—É—Ö—ç—Ç–∞–ø–Ω—É—é —Å–±–æ—Ä–∫—É –Ω–∞ —Å–±–æ—Ä–∫—É 2-—É—Ö –æ–±—Ä–∞–∑–æ–≤ - "–ø–æ–±–æ–ª—å—à–µ" –∏ "–ø–æ–º–µ–Ω—å—à–µ".

üõ†Ô∏è –ö—Å—Ç–∞—Ç–∏, –¥–∞–≤–∞–π—Ç–µ —ç—Ç–æ —Å–¥–µ–ª–∞–µ–º –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å.

- –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `Build.Dockerfile` –∏ —Å–∫–æ–ø–∏—Ä—É–π—Ç–µ –≤ –Ω–µ–≥–æ –ø–µ—Ä–≤—É—é —á–∞—Å—Ç—å –∫–æ–¥–∞ –∏–∑ `Dockerfile`
  ```dockerfile
  # build environment
  FROM node:14-alpine as builder
  WORKDIR /app
  ENV PATH /app/node_modules/.bin:$PATH

  # copy React source codes into the build image
  COPY package.json ./
  COPY package-lock.json ./
  COPY src ./src
  COPY public ./public

  # install NPM packages according to package-lock.json
  RUN npm ci

  # this param needs to be supplied as --build-arg when building the image
  ARG API_URL
  # building the react application using the param
  RUN REACT_APP_API_URL=$API_URL npm run build
  ```
- –ê –≤–æ—Ç –∏—Å—Ö–æ–¥–Ω—ã–π `Dockerfile` –º—ã —Å–æ–∫—Ä–∞—Ç–∏–º. –£–¥–∞–ª–∏–º –∏–∑ —Ñ–∞–π–ª–∞ –∫–æ–¥ –ø—Ä–∏–≤–µ–¥—ë–Ω–Ω—ã–π –≤—ã—à–µ –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏–∑—É–µ–º –Ω–∞–∑–≤–∞–Ω–∏–µ –æ–±—Ä–∞–∑–∞, –∏–∑ –∫–æ—Ç–æ—Ä–æ–≥–æ –º—ã –±—É–¥–µ–º –≤ –∏—Ç–æ–≥–µ –∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ñ–∞–π–ª—ã.
  ```dockerfile
  ARG build
  # build environment
  FROM $build as builder

  # production environment
  FROM nginx:stable-alpine
  # copy the static site build result from our "heavy" build container
  # with NPM packages installed to a slim nginx web server image
  COPY --from=builder /app/build /usr/share/nginx/html
  EXPOSE 80
  CMD ["nginx", "-g", "daemon off;"]
  ``` 
  –ö–∞–∫ –≤–∏–¥–∏—Ç–µ, –ø—Ä–æ—Å—Ç–æ –∏ –ª–æ–≥–∏—á–Ω–æ.
- –î–æ–±–∞–≤–∏–º –µ—â—ë –æ–¥–∏–Ω, —Ç—Ä–µ—Ç–∏–π —Ñ–∞–π–ª `Test.Dockerfile`, –≤ –∫–æ—Ç–æ—Ä–æ–º –º—ã –∏ –±—É–¥–µ–º –ø—Ä–æ–≤–æ–¥–∏—Ç—å —Ç–µ—Å—Ç—ã
  ```dockerfile
  # test environment
  FROM spa-build:latest
  RUN npm run test
  ```
  –î–∞, –≤—Å–µ–≥–æ –¥–≤–µ —Å—Ç—Ä–æ—á–∫–∏.

üí° –í –∫–∞—á–µ—Å—Ç–≤–µ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã, –º—ã –º–æ–≥–ª–∏ –±—ã –ø–æ–≤—Ç–æ—Ä–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å "—Å–±–æ—Ä–æ—á–Ω—ã–π" –æ–±—Ä–∞–∑, –ø–µ—Ä–µ–¥–∞–≤ –∫–æ–º–∞–Ω–¥—É –∑–∞–ø—É—Å–∫–∞ —Ç–µ—Å—Ç–æ–≤ —á–µ—Ä–µ–∑ –∫–æ–º–∞–Ω–¥–Ω—É—é —Å—Ç—Ä–æ–∫—É.

–¢–µ–ø–µ—Ä—å –≤—Å—ë –≥–æ—Ç–æ–≤–æ –∫ —Ç–æ–º—É —á—Ç–æ–±—ã —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –≤—Å–µ —ç—Ç–∞–ø—ã —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å–æ —Å–±–æ—Ä–∫–æ–π –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º.
üõ†Ô∏è –î–æ–±–∞–≤—å—Ç–µ –≤ `.gitlab-ci.yml` –¥–æ–≤–æ–ª—å–Ω–æ –±–æ–ª—å—à–æ–π –∫—É—Å–æ–∫ –∫–æ–¥–∞. 
```yaml
stages:
- build
- test
- package

before_script:
  - docker login -u gitlab-ci-token -p $CI_JOB_TOKEN $CI_REGISTRY

build_spa_builder:
  stage: build
  script:
  - docker build -f ./spa/Build.Dockerfile --build-arg API_URL="http://$EXTERNAL_IP.nip.io" -t $SPA_DOCKER_BUILDER_IMAGE:$CI_COMMIT_SHORT_SHA ./spa
  - docker tag $SPA_DOCKER_BUILDER_IMAGE:$CI_COMMIT_SHORT_SHA  $SPA_DOCKER_BUILDER_IMAGE:latest
  - docker push $SPA_DOCKER_BUILDER_IMAGE:$CI_COMMIT_SHORT_SHA
  - docker push $SPA_DOCKER_BUILDER_IMAGE:latest

test_spa:
  stage: test
  script:
  - docker run $SPA_DOCKER_BUILDER_IMAGE:latest sh -c "CI=true npm test"
  dependencies:
  - build_spa_builder

build_spa:
  stage: package
  script:
  - docker build -f ./spa/Dockerfile --build-arg build=$SPA_DOCKER_BUILDER_IMAGE:latest -t $SPA_DOCKER_IMAGE:$CI_COMMIT_SHORT_SHA ./spa
  - docker tag  $SPA_DOCKER_IMAGE:$CI_COMMIT_SHORT_SHA $SPA_DOCKER_IMAGE:latest
  - docker push $SPA_DOCKER_IMAGE:$CI_COMMIT_SHORT_SHA
  - docker push $SPA_DOCKER_IMAGE:latest
  dependencies:
  - build_spa_builder

build_api:
  stage: package
  script:
  - docker build -f ./api/Dockerfile -t $API_DOCKER_IMAGE:$CI_COMMIT_SHORT_SHA ./api
  - docker tag $API_DOCKER_IMAGE:$CI_COMMIT_SHORT_SHA $API_DOCKER_IMAGE:latest
  - docker push $API_DOCKER_IMAGE:$CI_COMMIT_SHORT_SHA
  - docker push $API_DOCKER_IMAGE:latest
```
–î–∞–Ω–Ω—ã–π –∫–æ–¥ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ç—Ä–∏ —ç—Ç–∞–ø–∞ `build`, `test` –∏ `package`. 
–≠—Ç–∏ —ç—Ç–∞–ø—ã –≤ —Å–≤–æ—é –æ—á–µ—Ä–µ–¥—å —Å–æ–¥–µ—Ä–∂–∞—Ç jobs. –î–∞–≤–∞–π—Ç–µ –æ–±—Å—É–¥–∏–º –∫–∞–∫–æ–π job —á—Ç–æ –¥–µ–ª–∞–µ—Ç.

- **build**
  - **build_spa_builder** - —Å–æ–∑–¥–∞—ë–º –æ–±—Ä–∞–∑ "—Å–±–æ—Ä—â–∏–∫–∞"
- **test**
  - **test_spa** - —Ç–µ—Å—Ç–∏—Ä—É–µ–º **SPA**
- **package**
  - **build_spa** - –∫–æ–ø–∏—Ä—É–µ–º —Ñ–∞–π–ª—ã **SPA** –Ω–∞ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ã–π –æ–±—Ä–∞–∑
  - **build_api** - –∫–æ–ø–∏—Ä—É–µ–º —Ñ–∞–π–ª—ã **API**

–ö–æ–º–∞–Ω–¥—ã, —É–∫–∞–∑–∞–Ω–Ω—ã–µ –≤ `before_script` –±—É–¥—É—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω—ã –ø–µ—Ä–µ–¥ –∫–∞–∂–¥—ã–º job. –ú—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º `docker login` —á—Ç–æ–±—ã –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å runner –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ GitLab Docker Registry —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –¥–∞–Ω–Ω—ã—Ö –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è.
```yaml
  before_script:
  - docker login -u gitlab-ci-token -p $CI_JOB_TOKEN $CI_REGISTRY
``` 

–ú—ã —Ç—É—Ç –∏—Å–ø–æ–ª—å–∑—É–µ–º –Ω–µ–∫–æ—Ç–æ—Ä—ã–π –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ, –∫–æ—Ç–æ—Ä—ã–µ –Ω–∞—á–∏–Ω–∞—é—Ç—Å—è –Ω–∞ `CI_`, —ç—Ç–æ —Ç–∞–∫ –Ω–∞–∑—ã–≤–∞–µ–º—ã–µ [–ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ GitLab CI/CD](https://docs.gitlab.com/ee/ci/variables/). –ò—Ö –∑–Ω–∞—á–µ–Ω–∏—è –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω—ã –Ω–∞–º –ø–ª–∞—Ç—Ñ–æ—Ä–º–æ–π.

–ë–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ jobs –≤—ã—à–µ —É—Å—Ç—Ä–æ–µ–Ω—ã –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ –∑–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ–º **test_spa** –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–æ—â–µ –ø–æ—Ç–æ–º—É —á—Ç–æ –≤ –∏—Ç–æ–≥–µ –º—ã –Ω–µ –∑–∞–≥—Ä—É–∂–∞–µ–º –æ–±—Ä–∞–∑ –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π. –ï—Å–ª–∏ –≤—ã —Ö–æ—Ç–∏—Ç–µ —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º –Ω–µ–∫–æ–≥–æ job –∑–∞–≤–µ—Ä—à–∏—Ç—Å—è –ø—Ä–µ–¥—ã–¥—É—â–∏–π, –≤—ã –º–æ–∂–µ—Ç–µ —É–∫–∞–∑–∞—Ç—å –ø—Ä–µ–¥—ã–¥—É—â–∏–π –≤ `dependencies`.  –†–∞–∑–±–µ—Ä—ë–º –∫–æ–º–∞–Ω–¥—ã –Ω–∞ –ø—Ä–∏–º–µ—Ä–µ **build_spa_builder**.

```yaml
  script:
  - docker build -f ./spa/Build.Dockerfile --build-arg API_URL="http://$EXTERNAL_IP.nip.io" -t $SPA_DOCKER_BUILDER_IMAGE:$CI_COMMIT_SHORT_SHA ./spa
  - docker tag $SPA_DOCKER_BUILDER_IMAGE:$CI_COMMIT_SHORT_SHA  $SPA_DOCKER_BUILDER_IMAGE:latest
  - docker push $SPA_DOCKER_BUILDER_IMAGE:$CI_COMMIT_SHORT_SHA
  - docker push $SPA_DOCKER_BUILDER_IMAGE:latest
```
–¢—É—Ç –º—ã —Å–æ–∑–¥–∞—ë–º –æ–±—Ä–∞–∑, –∑–∞—Ç–µ–º —Ç–µ–≥–∏—Ä—É–µ–º –µ–≥–æ –º–µ—Ç–∫–æ–π —Å–æ—Å—Ç–æ—è—â–µ–π –∏–∑ –∑–Ω–∞—á–µ–Ω–∏—è –Ω–∞—à–µ–π –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –∏ –∫–æ—Ä–æ—Ç–∫–æ–≥–æ —Ö—ç—à–∞ —Ç–µ–∫—É—â–µ–≥–æ –∫–æ–º–º–∏—Ç–∞ –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ GitLab `CI_COMMIT_SHORT_SHA`. –ó–∞—Ç–µ–º –º—ã –∑–∞–≥—Ä—É–∂–∞–µ–º –æ–±—Ä–∞–∑ –≤ Docker-—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π GitLab. –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –æ–±—Ä–∞–∑–∞ **SPA** –º—ã —Ç–∞–∫–∂–µ –∏—Å–ø–æ–ª—å–∑—É–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é `EXTERNAL_IP` –∫–æ—Ç–æ—Ä—É—é –∑–∞–¥–∞–ª–∏ —Ä–∞–Ω–µ–µ.

–¶–µ–ª–µ–π –≤ —Ç–æ–º —á—Ç–æ–±—ã —Ç—ç–≥–∏—Ä–æ–≤–∞—Ç—å –æ–±—Ä–∞–∑ —Ö—ç—à–µ–º –∫–æ–º–º–∏—Ç–∞ –¥–≤–µ. 
- –í–æ-–ø–µ—Ä–≤—ã—Ö, –º—ã –ø–æ–π–º—ë–º –∏–∑ –∫–∞–∫–æ–π –≤–µ—Ä—Å–∏–∏ –∫–æ–¥–∞ —Å–æ–±—Ä–∞–Ω –æ–±—Ä–∞–∑. 
- –í–æ-–≤—Ç–æ—Ä—ã—Ö, –¥–ª—è –æ–±—Ä–∞–∑–æ–≤, –Ω–∞ –∫–æ—Ç–æ—Ä—ã–µ –±—É–¥—É—Ç —Å—Å—ã–ª–∞—Ç—å—Å—è YAML-—Ñ–∞–π–ª—ã —Ä–µ—Å—É—Ä—Å–æ–≤, Kubernetes —Å–º–æ–∂–µ—Ç –ø–æ–Ω—è—Ç—å —á—Ç–æ –æ–±—Ä–∞–∑ –∏–∑–º–µ–Ω–∏–ª—Å—è –∏ —á—Ç–æ –Ω—É–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å Pod.

üõ†Ô∏è –ò—Ç–∞–∫, –≤–æ–ª—à–µ–±–Ω—ã–π –º–æ–º–µ–Ω—Ç –∑–∞–ø—É—Å–∫–∞ –Ω–∞—à–µ–≥–æ –∫–æ–Ω–≤–µ–π–µ—Ä–∞ –Ω–∞—Å—Ç–∞–ª. –û–±–Ω–æ–≤–∏—Ç–µ –∫–æ–¥ –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ GitLab —Å–ª–µ–¥—É—é—â–µ–π –∫–æ–º–∞–Ω–¥–æ–π –≤ –ª–æ–∫–∞–ª—å–Ω–æ–π –∫–æ–Ω—Å–æ–ª–∏. –î–æ–±–∞–≤—å—Ç–µ –≤–µ—Å—å –∫–æ–¥, –∫–æ—Ç–æ—Ä—ã–π –≤—ã –µ—â–µ –Ω–µ –¥–æ–±–∞–≤–∏–ª–∏ –≤ –∏–Ω–¥–µ–∫—Å, –∑–∞–∫–æ–º–º–∏—Ç—å—Ç–µ –∏ —Å–¥–µ–ª–∞–π—Ç–µ push.
```bash
git add -A
git commit -m "Commit all the code remaining to build images with GitLab"
git push
```

üõ†Ô∏è –û—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É **CI/CD** -> **Pipelines** –≤ GitLab –∏ —É–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ —Å–±–æ—Ä–∫–∞ –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞—á–∞–ª–∏—Å—å. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –Ω–∞—à–µ–π –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π —Å–±–æ—Ä–∫–∏ –∏ –¥–æ–∂–¥–∏—Ç–µ—Å—å –µ—ë —É—Å–ø–µ—à–Ω–æ–≥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è. –ü—Ä–∏ —ç—Ç–æ–º –ø–æ–ª–µ–∑–Ω–æ –ø–æ–æ—Ç–∫—Ä—ã–≤–∞—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Ä–∞–∑–Ω—ã—Ö jobs –∏ –ø–æ–Ω–∞–±–ª—é–¥–∞—Ç—å –∑–∞ –æ–±–Ω–æ–≤–ª—è—é—â–µ–π—Å—è –≤—ã–¥–∞—á–µ–π –≤ –∫–æ–Ω—Å–æ–ª–∏.

–û—Ç–ª–∏—á–Ω–æ! –ú—ã —É–∂–µ —Å–æ–±–∏—Ä–∞–µ–º –≤—Å–µ –Ω—É–∂–Ω—ã–µ –Ω–∞–º –æ–±—Ä–∞–∑—ã –ø—Ä—è–º–æ –≤ GitLab.

### –†–µ–∞–ª–∏–∑—É–µ–º —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏–µ –≤ GKE

üõ†Ô∏è –î–∞–≤–∞–π—Ç–µ —Å–¥–µ–ª–∞–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–π —à–∞–≥ - —Ä–µ–∞–ª–∏–∑—É–µ–º —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏–µ –≤ Kubernetes –Ω–∞ GCP –ø—Ä–∏ –ø–æ–º–æ—â–∏ GitLab. –ò—Ç–∞–∫, –¥–æ–±–∞–≤—å—Ç–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π `stage` –≤ `.gitlab-ci.yml`.
```yaml
stages:
- build
- test
- package
- deploy
```

–ó–∞—Ç–µ–º –ø–æ—Å–ª–µ —à–∞–≥–æ–≤ —Å–±–æ—Ä–∫–∏ –¥–æ–±–∞–≤—å—Ç–µ —Ç–∞–∫–æ–π –∫–æ–¥.
```yaml
deploy_spa:
  stage: deploy
  image: "registry.gitlab.com/gitlab-org/cluster-integration/auto-deploy-image"
  # –Ω–∞–º –Ω—É–∂–Ω–æ —Ç—É—Ç –∑–∞–¥–∞—Ç—å environment –∏–Ω–∞—á–µ GitLab –Ω–µ –ø–µ—Ä–µ–¥–∞—Å—Ç –∑–Ω–∞—á–µ–Ω–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –Ω–∞—á–∏–Ω–∞—é—â–∏—Ö—Å—è —Å KUBE_
  environment: production
  before_script:
  - |
    kubectl create secret -n "$KUBE_NAMESPACE" \
    docker-registry regcred \
    --docker-server="$CI_REGISTRY" \
    --docker-username="${CI_DEPLOY_USER:-$CI_REGISTRY_USER}" \
    --docker-password="${CI_DEPLOY_PASSWORD:-$CI_REGISTRY_PASSWORD}" \
    --docker-email="$GITLAB_USER_EMAIL" \
    -o yaml --dry-run | kubectl replace -n "$KUBE_NAMESPACE" --force -f -
  script:
  # —Å–æ–∑–¥–∞—ë–º –¥–∏—Å–∫
  - sed -e "s/{{NAMESPACE}}/$KUBE_NAMESPACE/g" kubernetes/volume.yml | kubectl apply -f -
  # —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–µ–º API
  - sed -e "s/{{NAMESPACE}}/$KUBE_NAMESPACE/g" -e "s~{{API_IMAGE}}~$API_DOCKER_IMAGE:$CI_COMMIT_SHORT_SHA~g" kubernetes/api.yml | kubectl apply -f -
  # —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–µ–º SPA
  - sed -e "s/{{NAMESPACE}}/$KUBE_NAMESPACE/g" -e "s~{{SPA_IMAGE}}~$SPA_DOCKER_IMAGE:$CI_COMMIT_SHORT_SHA~g" kubernetes/spa.yml | kubectl apply -f -
  # –æ–±–Ω–æ–≤–ª—è–µ–º ingress
  - sed -e "s/{{NAMESPACE}}/$KUBE_NAMESPACE/g" -e "s/{{EXTERNAL_IP}}/$EXTERNAL_IP/g" kubernetes/ingress.yml | kubectl apply -f -
```

–¢—É—Ç –≤–Ω–∏–º–∞–Ω–∏—è –¥–æ—Å—Ç–æ–∏–Ω —Ç–æ—Ç —Ñ–∞–∫—Ç —á—Ç–æ –≤–º–µ—Å—Ç–æ `docker: stable` –º—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º –¥—Ä—É–≥–æ–π –æ–±—Ä–∞–∑. –í –ø—Ä–∏–Ω—Ü–∏–ø–µ, –Ω–∞–º –ø–æ–¥–æ–π–¥—ë—Ç –ª—é–±–æ–π –æ–±—Ä–∞–∑, –∏–º–µ—é—â–∏–π `kubectl`, –ø–æ—ç—Ç–æ–º—É –¥–ª—è –ø—Ä–æ—Å—Ç–æ—Ç—ã –º—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º –æ–±—Ä–∞–∑ `registry.gitlab.com/gitlab-org/cluster-integration/auto-deploy-image` –∫–æ—Ç–æ—Ä—ã–π GitLab –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –¥–ª—è —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏–µ –≤ Kubernetes –≤ —Ä–µ–∂–∏–º–µ AutoDevOps. 

–¢–∞–∫–∂–µ –º—ã [–ø–æ–ª—å–∑—É–µ–º—Å—è —Ñ–∞–∫—Ç–æ–º —á—Ç–æ –Ω–∞—à –∫–ª–∞—Å—Ç–µ—Ä –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω —Å GitLab](https://docs.gitlab.com/ee/user/project/clusters/deploy_to_cluster.html#deployment-variables). –ü–æ —ç—Ç–æ–π –ø—Ä–∏—á–∏–Ω–µ –º—ã –º–æ–∂–µ–º –ø–æ–ª–∞–≥–∞—Ç—å—Å—è –Ω–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–µ –Ω–∞—á–∏–Ω–∞—é—Ç—Å—è —Å `KUBE_`, –æ–Ω–∏ –±—É–¥—É—Ç –ø–µ—Ä–µ–¥–∞–Ω—ã –≤ –∫–æ–Ω–≤–µ–π–µ—Ä –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.

–ú—ã –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–∏–ª–∏ `before_scripts`.
- –ú—ã –Ω–µ —Ö–æ—Ç–∏–º —á—Ç–æ–±—ã –ø–µ—Ä–µ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ–º –∫–æ–º–∞–Ω–¥ –Ω–∞—à–µ–≥–æ `job` –±—ã–ª–∞ –ø–æ–ø—ã—Ç–∫–∞ –∑–∞–ª–æ–≥–∏–Ω–∏—Ç—å—Å—è –≤ `docker`.
- –ú—ã —Ö–æ—Ç–∏–º –¥–∞—Ç—å –Ω–∞—à–∏–º Pods –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∑–∞–≥—Ä—É–∂–∞—Ç—å –æ–±—Ä–∞–∑—ã –∏–∑ GitLab Docker Registry.

–ü—Ä–∏–≤–æ–∂—É –ø–æ–ª–Ω—ã–π –∫–æ–¥ `.gitlab-ci.yml` –∫–æ—Ç–æ—Ä—ã–π –¥–æ–ª–∂–µ–Ω –±—ã–ª –ø–æ–ª—É—á–∏—Ç—å—Å—è.

```yaml
image: docker:stable
services:
- docker:dind
variables:
  DOCKER_DRIVER: overlay2
  SPA_DOCKER_IMAGE: $CI_REGISTRY_IMAGE/spa
  SPA_DOCKER_BUILDER_IMAGE: $CI_REGISTRY_IMAGE/spa-build
  API_DOCKER_IMAGE: $CI_REGISTRY_IMAGE/api

stages:
- build
- test
- package
- deploy

before_script:
- docker login -u gitlab-ci-token -p $CI_JOB_TOKEN $CI_REGISTRY

build_spa_builder:
  stage: build
  script:
  - docker build -f ./spa/Build.Dockerfile --build-arg API_URL="http://$EXTERNAL_IP.nip.io" -t $SPA_DOCKER_BUILDER_IMAGE:$CI_COMMIT_SHORT_SHA ./spa
  - docker tag $SPA_DOCKER_BUILDER_IMAGE:$CI_COMMIT_SHORT_SHA  $SPA_DOCKER_BUILDER_IMAGE:latest
  - docker push $SPA_DOCKER_BUILDER_IMAGE:$CI_COMMIT_SHORT_SHA
  - docker push $SPA_DOCKER_BUILDER_IMAGE:latest

test_spa:
  stage: test
  script:
  - docker run $SPA_DOCKER_BUILDER_IMAGE:latest sh -c "CI=true npm test"
  dependencies:
  - build_spa_builder

build_spa:
  stage: package
  script:
  - docker build -f ./spa/Dockerfile --build-arg build=$SPA_DOCKER_BUILDER_IMAGE:latest -t $SPA_DOCKER_IMAGE:$CI_COMMIT_SHORT_SHA ./spa
  - docker tag  $SPA_DOCKER_IMAGE:$CI_COMMIT_SHORT_SHA $SPA_DOCKER_IMAGE:latest
  - docker push $SPA_DOCKER_IMAGE:$CI_COMMIT_SHORT_SHA
  - docker push $SPA_DOCKER_IMAGE:latest
  dependencies:
  - build_spa_builder

build_api:
  stage: package
  script:
  - docker build -f ./api/Dockerfile -t $API_DOCKER_IMAGE:$CI_COMMIT_SHORT_SHA ./api
  - docker tag $API_DOCKER_IMAGE:$CI_COMMIT_SHORT_SHA $API_DOCKER_IMAGE:latest
  - docker push $API_DOCKER_IMAGE:$CI_COMMIT_SHORT_SHA
  - docker push $API_DOCKER_IMAGE:latest

deploy_spa:
  stage: deploy
  image: "registry.gitlab.com/gitlab-org/cluster-integration/auto-deploy-image"
  # –Ω–∞–º –Ω—É–∂–Ω–æ —Ç—É—Ç –∑–∞–¥–∞—Ç—å environment –∏–Ω–∞—á–µ GitLab –Ω–µ –ø–µ—Ä–µ–¥–∞—Å—Ç –∑–Ω–∞—á–µ–Ω–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –Ω–∞—á–∏–Ω–∞—é—â–∏—Ö—Å—è —Å KUBE
  environment: production
  before_script:
    - |
    kubectl create secret -n "$KUBE_NAMESPACE" \
    docker-registry regcred \
    --docker-server="$CI_REGISTRY" \
    --docker-username="${CI_DEPLOY_USER:-$CI_REGISTRY_USER}" \
    --docker-password="${CI_DEPLOY_PASSWORD:-$CI_REGISTRY_PASSWORD}" \
    --docker-email="$GITLAB_USER_EMAIL" \
    -o yaml --dry-run | kubectl replace -n "$KUBE_NAMESPACE" --force -f -
  script:
  # —Å–æ–∑–¥–∞—ë–º –¥–∏—Å–∫
  - sed -e "s/{{NAMESPACE}}/$KUBE_NAMESPACE/g" kubernetes/volume.yml | kubectl apply -f -
  # —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–µ–º API
  - sed -e "s/{{NAMESPACE}}/$KUBE_NAMESPACE/g" -e "s~{{API_IMAGE}}~$API_DOCKER_IMAGE:$CI_COMMIT_SHORT_SHA~g" kubernetes/api.yml | kubectl apply -f -
  # —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–µ–º SPA
  - sed -e "s/{{NAMESPACE}}/$KUBE_NAMESPACE/g" -e "s~{{SPA_IMAGE}}~$SPA_DOCKER_IMAGE:$CI_COMMIT_SHORT_SHA~g" kubernetes/spa.yml | kubectl apply -f -
  # –æ–±–Ω–æ–≤–ª—è–µ–º ingress
  - sed -e "s/{{NAMESPACE}}/$KUBE_NAMESPACE/g" -e "s/{{EXTERNAL_IP}}/$EXTERNAL_IP/g" kubernetes/ingress.yml | kubectl apply -f -
```

üõ†Ô∏è –ó–∞–∫–æ–º–º–∏—Ç—å—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ push –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
```bash
git add -A
git commit -m "Commit the code to deploy to GKE with GitLab"
git push
```

–ü–µ—Ä–µ–π–¥–∏—Ç–µ –ø–æ –∞–¥—Ä–µ—Å—É `http://EXTERNAL_IP.nip.io` –≤ –±—Ä–∞—É–∑–µ—Ä–µ –∏ —É–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞—Ä–∞–±–æ—Ç–∞–ª–æ. –ú–æ–∂–µ—Ç –ø–æ–Ω–∞–¥–æ–±–∏—Ç—å—Å—è –ø–æ–¥–æ–∂–¥–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –º–∏–Ω—É—Ç —á—Ç–æ–±—ã –≤—Å–µ —Ä–µ—Å—É—Ä—Å—ã —É—Å–ø–µ–ª–∏ –æ–±–Ω–æ–≤–∏—Ç—å—Å—è. 

üí° –ï—Å–ª–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è, –Ω–æ Deployments —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∏—Ä—É—é—Ç –±–µ–∑ –æ—à–∏–±–æ–∫, –æ—Å–æ–±–µ–Ω–Ω–æ –µ—Å–ª–∏ –ø—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ –ø–æ –∞–¥—Ä–µ—Å—É –≤—ã—à–µ –≤—ã –ø–æ–ª—É—á–∞–µ—Ç–µ –∫–æ–¥ 404, –µ—Å—Ç—å –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å —á—Ç–æ GCP –ø—Ä–∏—Å–≤–æ–∏–ª –≤–Ω–æ–≤—å —Å–æ–∑–¥–∞–Ω–Ω–æ–º—É Ingress –¥—Ä—É–≥–æ–π –≤–Ω–µ—à–Ω–∏–π IP. –≠—Ç–æ –ª–µ–≥–∫–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å!
- –£–∑–Ω–∞–π—Ç–µ –Ω–æ–≤—ã–π –∞–¥—Ä–µ—Å IP
  ```bash
  kubectl get ingress -n <namespace —Å–æ–∑–¥–∞–Ω–Ω–∞–µ GitLab>
  ```
- –ò–∑–º–µ–Ω–∏—Ç–µ –∑–Ω–∞—á–µ–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π `EXTERNAL_IP` –≤ GitLab —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ.
- –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –∫–æ–Ω–≤–µ–π–µ—Ä –≤ GitLab.

## üéâ –ü–æ–∑–¥—Ä–∞–≤–ª—è—é! 

–í—ã –¥–æ–∫–µ—Ä–∏–∑–æ–≤–∞–ª–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–∞ React.js, –∑–∞—Ç–µ–º —Ä–∞–∑–≤–µ—Ä–Ω—É–ª–∏ –µ–≥–æ –≤ Kubernetes –≤—Ä—É—á–Ω—É—é –∏ –≤ –∏—Ç–æ–≥–µ —Å–æ–∑–¥–∞–ª–∏ –∫–æ–Ω–≤–µ–π–µ—Ä –Ω–µ–ø—Ä–µ—Ä—ã–≤–Ω–æ–≥–æ —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏–µ —ç—Ç–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ Kubernetes –ø—Ä–∏ –ø–æ–º–æ—â–∏ GitLab!

üßπ –ù–µ –∑–∞–±—É–¥—å—Ç–µ —É–¥–∞–ª–∏—Ç—å –Ω–µ–Ω—É–∂–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã, —Å–æ–∑–¥–∞–Ω–Ω—ã–µ –Ω–∞ Google Cloud Platform.
